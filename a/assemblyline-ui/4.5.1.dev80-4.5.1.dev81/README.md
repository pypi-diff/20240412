# Comparing `tmp/assemblyline_ui-4.5.1.dev80-py3-none-any.whl.zip` & `tmp/assemblyline_ui-4.5.1.dev81-py3-none-any.whl.zip`

## zipinfo {}

```diff
@@ -1,79 +1,79 @@
-Zip file size: 175533 bytes, number of entries: 77
--rw-r--r--  2.0 unx       12 b- defN 24-Apr-12 20:13 assemblyline_ui/VERSION
--rw-r--r--  2.0 unx        0 b- defN 24-Apr-12 20:13 assemblyline_ui/__init__.py
--rw-r--r--  2.0 unx     6736 b- defN 24-Apr-12 20:13 assemblyline_ui/app.py
--rw-r--r--  2.0 unx     5957 b- defN 24-Apr-12 20:13 assemblyline_ui/config.py
--rw-r--r--  2.0 unx     3690 b- defN 24-Apr-12 20:13 assemblyline_ui/error.py
--rw-r--r--  2.0 unx      740 b- defN 24-Apr-12 20:13 assemblyline_ui/gunicorn_config.py
--rw-r--r--  2.0 unx      115 b- defN 24-Apr-12 20:13 assemblyline_ui/gunicorn_config_socketio.py
--rw-r--r--  2.0 unx      777 b- defN 24-Apr-12 20:13 assemblyline_ui/healthz.py
--rw-r--r--  2.0 unx      199 b- defN 24-Apr-12 20:13 assemblyline_ui/http_exceptions.py
--rw-r--r--  2.0 unx     2322 b- defN 24-Apr-12 20:13 assemblyline_ui/logger.py
--rw-r--r--  2.0 unx       85 b- defN 24-Apr-12 20:13 assemblyline_ui/patched.py
--rw-r--r--  2.0 unx     2596 b- defN 24-Apr-12 20:13 assemblyline_ui/socketsrv.py
--rw-r--r--  2.0 unx        0 b- defN 24-Apr-12 20:13 assemblyline_ui/api/__init__.py
--rw-r--r--  2.0 unx    14502 b- defN 24-Apr-12 20:13 assemblyline_ui/api/base.py
--rw-r--r--  2.0 unx     3915 b- defN 24-Apr-12 20:13 assemblyline_ui/api/v4/__init__.py
--rw-r--r--  2.0 unx    37510 b- defN 24-Apr-12 20:13 assemblyline_ui/api/v4/alert.py
--rw-r--r--  2.0 unx    24904 b- defN 24-Apr-12 20:13 assemblyline_ui/api/v4/archive.py
--rw-r--r--  2.0 unx     1866 b- defN 24-Apr-12 20:13 assemblyline_ui/api/v4/assistant.py
--rw-r--r--  2.0 unx    33569 b- defN 24-Apr-12 20:13 assemblyline_ui/api/v4/authentication.py
--rw-r--r--  2.0 unx    32455 b- defN 24-Apr-12 20:13 assemblyline_ui/api/v4/badlist.py
--rw-r--r--  2.0 unx     5141 b- defN 24-Apr-12 20:13 assemblyline_ui/api/v4/bundle.py
--rw-r--r--  2.0 unx     2560 b- defN 24-Apr-12 20:13 assemblyline_ui/api/v4/error.py
--rw-r--r--  2.0 unx    12508 b- defN 24-Apr-12 20:13 assemblyline_ui/api/v4/federated_lookup.py
--rw-r--r--  2.0 unx    55854 b- defN 24-Apr-12 20:13 assemblyline_ui/api/v4/file.py
--rw-r--r--  2.0 unx    11900 b- defN 24-Apr-12 20:13 assemblyline_ui/api/v4/hash_search.py
--rw-r--r--  2.0 unx     6367 b- defN 24-Apr-12 20:13 assemblyline_ui/api/v4/help.py
--rw-r--r--  2.0 unx     2910 b- defN 24-Apr-12 20:13 assemblyline_ui/api/v4/heuristics.py
--rw-r--r--  2.0 unx    20441 b- defN 24-Apr-12 20:13 assemblyline_ui/api/v4/ingest.py
--rw-r--r--  2.0 unx     5477 b- defN 24-Apr-12 20:13 assemblyline_ui/api/v4/live.py
--rw-r--r--  2.0 unx    13223 b- defN 24-Apr-12 20:13 assemblyline_ui/api/v4/ontology.py
--rw-r--r--  2.0 unx     7985 b- defN 24-Apr-12 20:13 assemblyline_ui/api/v4/replay.py
--rw-r--r--  2.0 unx     6203 b- defN 24-Apr-12 20:13 assemblyline_ui/api/v4/result.py
--rw-r--r--  2.0 unx    23121 b- defN 24-Apr-12 20:13 assemblyline_ui/api/v4/retrohunt.py
--rw-r--r--  2.0 unx    23196 b- defN 24-Apr-12 20:13 assemblyline_ui/api/v4/safelist.py
--rw-r--r--  2.0 unx    20528 b- defN 24-Apr-12 20:13 assemblyline_ui/api/v4/search.py
--rw-r--r--  2.0 unx    39389 b- defN 24-Apr-12 20:13 assemblyline_ui/api/v4/service.py
--rw-r--r--  2.0 unx    26966 b- defN 24-Apr-12 20:13 assemblyline_ui/api/v4/signature.py
--rw-r--r--  2.0 unx    46126 b- defN 24-Apr-12 20:13 assemblyline_ui/api/v4/submission.py
--rw-r--r--  2.0 unx    20443 b- defN 24-Apr-12 20:13 assemblyline_ui/api/v4/submit.py
--rw-r--r--  2.0 unx    20730 b- defN 24-Apr-12 20:13 assemblyline_ui/api/v4/system.py
--rw-r--r--  2.0 unx    11728 b- defN 24-Apr-12 20:13 assemblyline_ui/api/v4/ui.py
--rw-r--r--  2.0 unx    40316 b- defN 24-Apr-12 20:13 assemblyline_ui/api/v4/user.py
--rw-r--r--  2.0 unx     4734 b- defN 24-Apr-12 20:13 assemblyline_ui/api/v4/webauthn.py
--rw-r--r--  2.0 unx    10308 b- defN 24-Apr-12 20:13 assemblyline_ui/api/v4/workflow.py
--rw-r--r--  2.0 unx        0 b- defN 24-Apr-12 20:13 assemblyline_ui/helper/__init__.py
--rw-r--r--  2.0 unx     1686 b- defN 24-Apr-12 20:13 assemblyline_ui/helper/discover.py
--rw-r--r--  2.0 unx     8154 b- defN 24-Apr-12 20:13 assemblyline_ui/helper/oauth.py
--rw-r--r--  2.0 unx     4926 b- defN 24-Apr-12 20:13 assemblyline_ui/helper/result.py
--rw-r--r--  2.0 unx     1686 b- defN 24-Apr-12 20:13 assemblyline_ui/helper/search.py
--rw-r--r--  2.0 unx     3260 b- defN 24-Apr-12 20:13 assemblyline_ui/helper/service.py
--rw-r--r--  2.0 unx      899 b- defN 24-Apr-12 20:13 assemblyline_ui/helper/signature.py
--rw-r--r--  2.0 unx     6835 b- defN 24-Apr-12 20:13 assemblyline_ui/helper/submission.py
--rw-r--r--  2.0 unx     7628 b- defN 24-Apr-12 20:13 assemblyline_ui/helper/user.py
--rw-r--r--  2.0 unx      443 b- defN 24-Apr-12 20:13 assemblyline_ui/helper/ai/__init__.py
--rw-r--r--  2.0 unx      895 b- defN 24-Apr-12 20:13 assemblyline_ui/helper/ai/base.py
--rw-r--r--  2.0 unx     5569 b- defN 24-Apr-12 20:13 assemblyline_ui/helper/ai/cohere.py
--rw-r--r--  2.0 unx     5267 b- defN 24-Apr-12 20:13 assemblyline_ui/helper/ai/openai.py
--rw-r--r--  2.0 unx        0 b- defN 24-Apr-12 20:13 assemblyline_ui/security/__init__.py
--rw-r--r--  2.0 unx     1410 b- defN 24-Apr-12 20:13 assemblyline_ui/security/apikey_auth.py
--rw-r--r--  2.0 unx    10116 b- defN 24-Apr-12 20:13 assemblyline_ui/security/authenticator.py
--rw-r--r--  2.0 unx    13749 b- defN 24-Apr-12 20:13 assemblyline_ui/security/ldap_auth.py
--rw-r--r--  2.0 unx     3074 b- defN 24-Apr-12 20:13 assemblyline_ui/security/oauth_auth.py
--rw-r--r--  2.0 unx     2951 b- defN 24-Apr-12 20:13 assemblyline_ui/security/second_factor_auth.py
--rw-r--r--  2.0 unx      750 b- defN 24-Apr-12 20:13 assemblyline_ui/security/userpass_auth.py
--rw-r--r--  2.0 unx        0 b- defN 24-Apr-12 20:13 assemblyline_ui/sio/__init__.py
--rw-r--r--  2.0 unx     2170 b- defN 24-Apr-12 20:13 assemblyline_ui/sio/alert.py
--rw-r--r--  2.0 unx     3529 b- defN 24-Apr-12 20:13 assemblyline_ui/sio/base.py
--rw-r--r--  2.0 unx     2041 b- defN 24-Apr-12 20:13 assemblyline_ui/sio/file.py
--rw-r--r--  2.0 unx     4158 b- defN 24-Apr-12 20:13 assemblyline_ui/sio/live_submission.py
--rw-r--r--  2.0 unx     2146 b- defN 24-Apr-12 20:13 assemblyline_ui/sio/retrohunt.py
--rw-r--r--  2.0 unx     1980 b- defN 24-Apr-12 20:13 assemblyline_ui/sio/status.py
--rw-r--r--  2.0 unx     2222 b- defN 24-Apr-12 20:13 assemblyline_ui/sio/submission.py
--rw-r--r--  2.0 unx     1396 b- defN 24-Apr-12 20:13 assemblyline_ui-4.5.1.dev80.dist-info/LICENCE.md
--rw-r--r--  2.0 unx     2898 b- defN 24-Apr-12 20:13 assemblyline_ui-4.5.1.dev80.dist-info/METADATA
--rw-r--r--  2.0 unx       92 b- defN 24-Apr-12 20:13 assemblyline_ui-4.5.1.dev80.dist-info/WHEEL
--rw-r--r--  2.0 unx       16 b- defN 24-Apr-12 20:13 assemblyline_ui-4.5.1.dev80.dist-info/top_level.txt
--rw-rw-r--  2.0 unx     6913 b- defN 24-Apr-12 20:13 assemblyline_ui-4.5.1.dev80.dist-info/RECORD
-77 files, 718963 bytes uncompressed, 164487 bytes compressed:  77.1%
+Zip file size: 176852 bytes, number of entries: 77
+-rw-r--r--  2.0 unx       12 b- defN 24-Apr-12 20:47 assemblyline_ui/VERSION
+-rw-r--r--  2.0 unx        0 b- defN 24-Apr-12 20:46 assemblyline_ui/__init__.py
+-rw-r--r--  2.0 unx     6736 b- defN 24-Apr-12 20:46 assemblyline_ui/app.py
+-rw-r--r--  2.0 unx     5951 b- defN 24-Apr-12 20:46 assemblyline_ui/config.py
+-rw-r--r--  2.0 unx     3690 b- defN 24-Apr-12 20:46 assemblyline_ui/error.py
+-rw-r--r--  2.0 unx      740 b- defN 24-Apr-12 20:46 assemblyline_ui/gunicorn_config.py
+-rw-r--r--  2.0 unx      115 b- defN 24-Apr-12 20:46 assemblyline_ui/gunicorn_config_socketio.py
+-rw-r--r--  2.0 unx      777 b- defN 24-Apr-12 20:46 assemblyline_ui/healthz.py
+-rw-r--r--  2.0 unx      199 b- defN 24-Apr-12 20:46 assemblyline_ui/http_exceptions.py
+-rw-r--r--  2.0 unx     2322 b- defN 24-Apr-12 20:46 assemblyline_ui/logger.py
+-rw-r--r--  2.0 unx       85 b- defN 24-Apr-12 20:46 assemblyline_ui/patched.py
+-rw-r--r--  2.0 unx     2596 b- defN 24-Apr-12 20:46 assemblyline_ui/socketsrv.py
+-rw-r--r--  2.0 unx        0 b- defN 24-Apr-12 20:46 assemblyline_ui/api/__init__.py
+-rw-r--r--  2.0 unx    14502 b- defN 24-Apr-12 20:46 assemblyline_ui/api/base.py
+-rw-r--r--  2.0 unx     3915 b- defN 24-Apr-12 20:46 assemblyline_ui/api/v4/__init__.py
+-rw-r--r--  2.0 unx    37510 b- defN 24-Apr-12 20:46 assemblyline_ui/api/v4/alert.py
+-rw-r--r--  2.0 unx    24904 b- defN 24-Apr-12 20:46 assemblyline_ui/api/v4/archive.py
+-rw-r--r--  2.0 unx     1866 b- defN 24-Apr-12 20:46 assemblyline_ui/api/v4/assistant.py
+-rw-r--r--  2.0 unx    33569 b- defN 24-Apr-12 20:46 assemblyline_ui/api/v4/authentication.py
+-rw-r--r--  2.0 unx    32455 b- defN 24-Apr-12 20:46 assemblyline_ui/api/v4/badlist.py
+-rw-r--r--  2.0 unx     5141 b- defN 24-Apr-12 20:46 assemblyline_ui/api/v4/bundle.py
+-rw-r--r--  2.0 unx     2560 b- defN 24-Apr-12 20:46 assemblyline_ui/api/v4/error.py
+-rw-r--r--  2.0 unx    12508 b- defN 24-Apr-12 20:46 assemblyline_ui/api/v4/federated_lookup.py
+-rw-r--r--  2.0 unx    55854 b- defN 24-Apr-12 20:46 assemblyline_ui/api/v4/file.py
+-rw-r--r--  2.0 unx    11900 b- defN 24-Apr-12 20:46 assemblyline_ui/api/v4/hash_search.py
+-rw-r--r--  2.0 unx     6367 b- defN 24-Apr-12 20:46 assemblyline_ui/api/v4/help.py
+-rw-r--r--  2.0 unx     2910 b- defN 24-Apr-12 20:46 assemblyline_ui/api/v4/heuristics.py
+-rw-r--r--  2.0 unx    20441 b- defN 24-Apr-12 20:46 assemblyline_ui/api/v4/ingest.py
+-rw-r--r--  2.0 unx     5477 b- defN 24-Apr-12 20:46 assemblyline_ui/api/v4/live.py
+-rw-r--r--  2.0 unx    13223 b- defN 24-Apr-12 20:46 assemblyline_ui/api/v4/ontology.py
+-rw-r--r--  2.0 unx     7985 b- defN 24-Apr-12 20:46 assemblyline_ui/api/v4/replay.py
+-rw-r--r--  2.0 unx     6203 b- defN 24-Apr-12 20:46 assemblyline_ui/api/v4/result.py
+-rw-r--r--  2.0 unx    23121 b- defN 24-Apr-12 20:46 assemblyline_ui/api/v4/retrohunt.py
+-rw-r--r--  2.0 unx    23196 b- defN 24-Apr-12 20:46 assemblyline_ui/api/v4/safelist.py
+-rw-r--r--  2.0 unx    20528 b- defN 24-Apr-12 20:46 assemblyline_ui/api/v4/search.py
+-rw-r--r--  2.0 unx    39389 b- defN 24-Apr-12 20:46 assemblyline_ui/api/v4/service.py
+-rw-r--r--  2.0 unx    26966 b- defN 24-Apr-12 20:46 assemblyline_ui/api/v4/signature.py
+-rw-r--r--  2.0 unx    46126 b- defN 24-Apr-12 20:46 assemblyline_ui/api/v4/submission.py
+-rw-r--r--  2.0 unx    20443 b- defN 24-Apr-12 20:46 assemblyline_ui/api/v4/submit.py
+-rw-r--r--  2.0 unx    20730 b- defN 24-Apr-12 20:46 assemblyline_ui/api/v4/system.py
+-rw-r--r--  2.0 unx    11728 b- defN 24-Apr-12 20:46 assemblyline_ui/api/v4/ui.py
+-rw-r--r--  2.0 unx    40316 b- defN 24-Apr-12 20:46 assemblyline_ui/api/v4/user.py
+-rw-r--r--  2.0 unx     4734 b- defN 24-Apr-12 20:46 assemblyline_ui/api/v4/webauthn.py
+-rw-r--r--  2.0 unx    10308 b- defN 24-Apr-12 20:46 assemblyline_ui/api/v4/workflow.py
+-rw-r--r--  2.0 unx        0 b- defN 24-Apr-12 20:46 assemblyline_ui/helper/__init__.py
+-rw-r--r--  2.0 unx     1686 b- defN 24-Apr-12 20:46 assemblyline_ui/helper/discover.py
+-rw-r--r--  2.0 unx     8154 b- defN 24-Apr-12 20:46 assemblyline_ui/helper/oauth.py
+-rw-r--r--  2.0 unx     4926 b- defN 24-Apr-12 20:46 assemblyline_ui/helper/result.py
+-rw-r--r--  2.0 unx     1686 b- defN 24-Apr-12 20:46 assemblyline_ui/helper/search.py
+-rw-r--r--  2.0 unx     3260 b- defN 24-Apr-12 20:46 assemblyline_ui/helper/service.py
+-rw-r--r--  2.0 unx      899 b- defN 24-Apr-12 20:46 assemblyline_ui/helper/signature.py
+-rw-r--r--  2.0 unx     6835 b- defN 24-Apr-12 20:46 assemblyline_ui/helper/submission.py
+-rw-r--r--  2.0 unx     7628 b- defN 24-Apr-12 20:46 assemblyline_ui/helper/user.py
+-rw-r--r--  2.0 unx      445 b- defN 24-Apr-12 20:46 assemblyline_ui/helper/ai/__init__.py
+-rw-r--r--  2.0 unx     4895 b- defN 24-Apr-12 20:46 assemblyline_ui/helper/ai/base.py
+-rw-r--r--  2.0 unx     5692 b- defN 24-Apr-12 20:46 assemblyline_ui/helper/ai/cohere.py
+-rw-r--r--  2.0 unx     5446 b- defN 24-Apr-12 20:46 assemblyline_ui/helper/ai/openai.py
+-rw-r--r--  2.0 unx        0 b- defN 24-Apr-12 20:46 assemblyline_ui/security/__init__.py
+-rw-r--r--  2.0 unx     1410 b- defN 24-Apr-12 20:46 assemblyline_ui/security/apikey_auth.py
+-rw-r--r--  2.0 unx    10116 b- defN 24-Apr-12 20:46 assemblyline_ui/security/authenticator.py
+-rw-r--r--  2.0 unx    13749 b- defN 24-Apr-12 20:46 assemblyline_ui/security/ldap_auth.py
+-rw-r--r--  2.0 unx     3074 b- defN 24-Apr-12 20:46 assemblyline_ui/security/oauth_auth.py
+-rw-r--r--  2.0 unx     2951 b- defN 24-Apr-12 20:46 assemblyline_ui/security/second_factor_auth.py
+-rw-r--r--  2.0 unx      750 b- defN 24-Apr-12 20:46 assemblyline_ui/security/userpass_auth.py
+-rw-r--r--  2.0 unx        0 b- defN 24-Apr-12 20:46 assemblyline_ui/sio/__init__.py
+-rw-r--r--  2.0 unx     2170 b- defN 24-Apr-12 20:46 assemblyline_ui/sio/alert.py
+-rw-r--r--  2.0 unx     3529 b- defN 24-Apr-12 20:46 assemblyline_ui/sio/base.py
+-rw-r--r--  2.0 unx     2041 b- defN 24-Apr-12 20:46 assemblyline_ui/sio/file.py
+-rw-r--r--  2.0 unx     4158 b- defN 24-Apr-12 20:46 assemblyline_ui/sio/live_submission.py
+-rw-r--r--  2.0 unx     2146 b- defN 24-Apr-12 20:46 assemblyline_ui/sio/retrohunt.py
+-rw-r--r--  2.0 unx     1980 b- defN 24-Apr-12 20:46 assemblyline_ui/sio/status.py
+-rw-r--r--  2.0 unx     2222 b- defN 24-Apr-12 20:46 assemblyline_ui/sio/submission.py
+-rw-r--r--  2.0 unx     1396 b- defN 24-Apr-12 20:47 assemblyline_ui-4.5.1.dev81.dist-info/LICENCE.md
+-rw-r--r--  2.0 unx     2898 b- defN 24-Apr-12 20:47 assemblyline_ui-4.5.1.dev81.dist-info/METADATA
+-rw-r--r--  2.0 unx       92 b- defN 24-Apr-12 20:47 assemblyline_ui-4.5.1.dev81.dist-info/WHEEL
+-rw-r--r--  2.0 unx       16 b- defN 24-Apr-12 20:47 assemblyline_ui-4.5.1.dev81.dist-info/top_level.txt
+-rw-rw-r--  2.0 unx     6914 b- defN 24-Apr-12 20:47 assemblyline_ui-4.5.1.dev81.dist-info/RECORD
+77 files, 723262 bytes uncompressed, 165806 bytes compressed:  77.1%
```

## zipnote {}

```diff
@@ -210,23 +210,23 @@
 
 Filename: assemblyline_ui/sio/status.py
 Comment: 
 
 Filename: assemblyline_ui/sio/submission.py
 Comment: 
 
-Filename: assemblyline_ui-4.5.1.dev80.dist-info/LICENCE.md
+Filename: assemblyline_ui-4.5.1.dev81.dist-info/LICENCE.md
 Comment: 
 
-Filename: assemblyline_ui-4.5.1.dev80.dist-info/METADATA
+Filename: assemblyline_ui-4.5.1.dev81.dist-info/METADATA
 Comment: 
 
-Filename: assemblyline_ui-4.5.1.dev80.dist-info/WHEEL
+Filename: assemblyline_ui-4.5.1.dev81.dist-info/WHEEL
 Comment: 
 
-Filename: assemblyline_ui-4.5.1.dev80.dist-info/top_level.txt
+Filename: assemblyline_ui-4.5.1.dev81.dist-info/top_level.txt
 Comment: 
 
-Filename: assemblyline_ui-4.5.1.dev80.dist-info/RECORD
+Filename: assemblyline_ui-4.5.1.dev81.dist-info/RECORD
 Comment: 
 
 Zip file comment:
```

## assemblyline_ui/VERSION

```diff
@@ -1 +1 @@
-4.5.1.dev80
+4.5.1.dev81
```

## assemblyline_ui/config.py

```diff
@@ -143,15 +143,15 @@
 FILESTORE: FileStore = forge.get_filestore(config=config)
 if config.datastore.archive.enabled:
     ARCHIVESTORE: FileStore = forge.get_archivestore(config=config)
 else:
     ARCHIVESTORE = None
 if config.ui.ai.enabled:
     AI_CACHE: Cache = Cache(prefix="ai_cache", host=redis, ttl=24 * 60 * 60)
-    AI_AGENT: AIAgent = get_ai_agent(config.ui.ai, LOGGER)
+    AI_AGENT: AIAgent = get_ai_agent(config, LOGGER)
 else:
     AI_CACHE = None
     AI_AGENT = None
 STORAGE: AssemblylineDatastore = forge.get_datastore(config=config, archive_access=True)
 metadata_validator = MetadataValidator(STORAGE)
 IDENTIFY: Identify = forge.get_identify(config=config, datastore=STORAGE, use_cache=True)
 ARCHIVE_MANAGER: ArchiveManager = ArchiveManager(
```

## assemblyline_ui/helper/ai/__init__.py

```diff
@@ -1,12 +1,12 @@
-from assemblyline.odm.models.config import AI as AIConfig
+from assemblyline.odm.models.config import Config
 from assemblyline_ui.helper.ai.cohere import CohereAgent
 from assemblyline_ui.helper.ai.openai import OpenAIAgent
 
 
-def get_ai_agent(config: AIConfig, logger):
-    if config.api_type == 'openai':
+def get_ai_agent(config: Config, logger):
+    if config.ui.ai.api_type == 'openai':
         return OpenAIAgent(config, logger)
-    elif config.api_type == 'cohere':
+    elif config.ui.ai.api_type == 'cohere':
         return CohereAgent(config, logger)
 
     raise ValueError(f'Invalid AI API type: {config.api_type}')
```

## assemblyline_ui/helper/ai/base.py

```diff
@@ -1,8 +1,12 @@
-from assemblyline.odm.models.config import AI as AIConfig
+from typing import List
+from assemblyline.common import forge
+from assemblyline.common.log import PrintLogger
+from assemblyline.odm.models.config import Config
+from assemblyline.odm.models.service import Service
 
 
 class APIException(Exception):
     pass
 
 
 class EmptyAIResponse(Exception):
@@ -10,22 +14,94 @@
 
 
 class UnimplementedException(Exception):
     pass
 
 
 class AIAgent():
-    def __init__(self, config: AIConfig, logger) -> None:
-        self.config = config
-        self.logger = logger
+    def __init__(self, config: Config, logger=None) -> None:
+        self.config = config.ui.ai
+        self.logger = logger or PrintLogger()
+        self.system_config = config
+        self.ds = forge.get_datastore()
+        self.classification = forge.get_classification()
+        self.scoring_prompt = self._build_scoring_prompt()
+        self.classification_prompt = self._build_classification_prompt()
+        self.services_prompt = self._build_services_prompt()
+        self.indices_prompt = self._build_indices_prompt()
+        self.system_prompt = self._build_system_prompt()
 
     def continued_ai_conversation(self, messages):
         raise UnimplementedException("Method not implemented yet")
 
     def detailed_al_submission(self, report, lang="english", with_trace=False):
         raise UnimplementedException("Method not implemented yet")
 
     def summarized_al_submission(self, report, lang="english", with_trace=False):
         raise UnimplementedException("Method not implemented yet")
 
     def summarize_code_snippet(self, code, lang="english", with_trace=False):
         raise UnimplementedException("Method not implemented yet")
+
+    def _build_scoring_prompt(self):
+        scoring = f"""Assemblyline uses a scoring mechanism where any scores below
+{self.system_config.submission.verdicts.info} is
+considered safe, scores between {self.system_config.submission.verdicts.info} and
+{self.system_config.submission.verdicts.suspicious} are considered informational,
+scores between {self.system_config.submission.verdicts.suspicious} and
+{self.system_config.submission.verdicts.highly_suspicious} are considered suspicious,
+scores between {self.system_config.submission.verdicts.highly_suspicious} and
+{self.system_config.submission.verdicts.malicious} are considered highly-suspicious and
+scores with {self.system_config.submission.verdicts.malicious} points and up are
+considered malicious.""".replace('\n', ' ')
+        return f"""### Assemblyline scoring definitions\n\n{scoring}"""
+
+    def _build_classification_prompt(self):
+        markings = '\n'.join([f"{marking} = {description}" for marking,
+                             description in self.classification.description.items()])
+        return f"""### Classification Marking definitions
+
+Assemblyline can classify/restrict access to its output with the following markings:
+
+{markings}"""
+
+    def _build_services_prompt(self):
+        service_list: List[Service] = self.ds.list_all_services()
+
+        def safe_description(description):
+            return description.replace("</br>", "\n").replace('\n', '\n  ')
+
+        services = "\n".join(
+            [f"name: {srv.name}\ncategory: {srv.category}"
+             f"\ndescription: |\n  {safe_description(srv.description)}"
+             for srv in service_list])
+        return f"### Services and plugin definitions\n\nAssemblyline does its processing using only the" \
+            f"following services/plugins:\n\n{services}"
+
+    def _build_indices_prompt(self):
+        collections = []
+        for index in ['alert', 'file', 'result', 'signature', 'submission']:
+            collection = self.ds.get_collection(index)
+            collection_fields = collection.fields(include_description=True)
+            collections.append(
+                f"\n#### {index.upper()} index definition\nThis is the list of fields that are available for "
+                f"query in the {index} index with their description and data type.\n")
+            collections.append(
+                "\n".join(
+                    [f"{name}: {field['description']} [{field['type']}]" for name,
+                     field in collection_fields.items() if field['indexed']]))
+        indices = '\n'.join(collections)
+        return "### Data index definitions\n\nAssemblyline has multiple indices where it stores the data, theses " \
+               f"indices can be queried with the lucene syntax.\n{indices}"
+
+    def _build_system_prompt(self):
+        return "## Definitions\n\nThe next few sections will provide you with the necessary information to help " \
+            "users understand the results produced by Assemblyline. " \
+            "Note that these are not Assemblyline results, just definitions.\n\n" \
+            f"{self.scoring_prompt}\n\n{self.classification_prompt}\n\n" \
+            f"{self.services_prompt}\n\n{self.indices_prompt}\n\n"
+
+
+if __name__ == "__main__":
+    agent = AIAgent(forge.get_config())
+    with open("prompt.txt", 'wb') as myfile:
+        myfile.write(agent.system_prompt.encode())
```

## assemblyline_ui/helper/ai/cohere.py

```diff
@@ -1,9 +1,9 @@
 from assemblyline.common.str_utils import safe_str
-from assemblyline.odm.models.config import AI as AIConfig
+from assemblyline.odm.models.config import Config
 from assemblyline_ui.helper.ai.base import AIAgent, APIException
 import requests
 import yaml
 
 ALLOWED_OPTIONS = ["temperature", "frequency_penalty", "presence_penalty", "seed"]
 ROLE_MAP = {
     "system": "SYSTEM",
@@ -12,15 +12,15 @@
     "SYSTEM": "system",
     "USER": "user",
     "CHATBOT": "assistant"
 }
 
 
 class CohereAgent(AIAgent):
-    def __init__(self, config: AIConfig, logger) -> None:
+    def __init__(self, config: Config, logger) -> None:
         super(CohereAgent, self).__init__(config, logger)
         self.session = requests.Session()
         self.session.headers = self.config.headers
         self.session.proxies = self.config.proxies
         self.config.assistant.options = {k: v for k, v in self.config.assistant.options.items() if k in ALLOWED_OPTIONS}
         self.config.code.options = {k: v for k, v in self.config.code.options.items() if k in ALLOWED_OPTIONS}
         self.config.detailed_report.options = {k: v for k,
@@ -80,15 +80,18 @@
         preamble, history, message = self._openai_to_cohere_messages(messages)
         # Build chat completions request
         data = {
             "max_tokens": self.config.assistant.max_tokens,
             "message": message or "Hello!",
             "chat_history": history,
             "model": self.config.model_name,
-            "stream": False
+            "stream": False,
+            "documents": [
+                {"title": "Glossary of Assemblyline terms", "snippet": self.system_prompt}
+            ]
         }
         if preamble:
             data['preamble'] = preamble
         data.update(self.config.assistant.options)
 
         return self._call_ai_backend(data, "answer the question", with_trace=True)
```

## assemblyline_ui/helper/ai/openai.py

```diff
@@ -1,18 +1,18 @@
 from assemblyline.common.str_utils import safe_str
-from assemblyline.odm.models.config import AI as AIConfig
+from assemblyline.odm.models.config import Config
 from assemblyline_ui.helper.ai.base import AIAgent, APIException, EmptyAIResponse
 import requests
 import yaml
 
 ALLOWED_OPTIONS = ["temperature", "frequency_penalty", "presence_penalty", "top_p", "seed"]
 
 
 class OpenAIAgent(AIAgent):
-    def __init__(self, config: AIConfig, logger) -> None:
+    def __init__(self, config: Config, logger) -> None:
         super(OpenAIAgent, self).__init__(config, logger)
         self.session = requests.Session()
         self.session.headers = self.config.headers
         self.session.proxies = self.config.proxies
         self.config.assistant.options = {k: v for k, v in self.config.assistant.options.items() if k in ALLOWED_OPTIONS}
         self.config.code.options = {k: v for k, v in self.config.code.options.items() if k in ALLOWED_OPTIONS}
         self.config.detailed_report.options = {k: v for k,
@@ -46,14 +46,17 @@
                 trace.append({'role': 'assistant', 'content': content})
                 return {'trace': trace, 'truncated': reason == 'length'}
             return {'content': content, 'truncated': reason == 'length'}
 
         raise EmptyAIResponse("There was no response returned by the AI")
 
     def continued_ai_conversation(self, messages):
+        if "## Definitions" not in messages[0]['content'] and messages[0]['role'] == 'system':
+            messages[0]['content'] = "\n".join([messages[0]['content'], self.system_prompt])
+
         # Make sure this is not an empty message
         messages[-1]['content'] = messages[-1]['content'] or "Hello"
 
         # Build chat completions request
         data = {
             "max_tokens": self.config.assistant.max_tokens,
             "messages": messages,
```

## Comparing `assemblyline_ui-4.5.1.dev80.dist-info/LICENCE.md` & `assemblyline_ui-4.5.1.dev81.dist-info/LICENCE.md`

 * *Files identical despite different names*

## Comparing `assemblyline_ui-4.5.1.dev80.dist-info/METADATA` & `assemblyline_ui-4.5.1.dev81.dist-info/METADATA`

 * *Files 1% similar despite different names*

```diff
@@ -1,10 +1,10 @@
 Metadata-Version: 2.1
 Name: assemblyline-ui
-Version: 4.5.1.dev80
+Version: 4.5.1.dev81
 Summary: Assemblyline 4 - API and Socket IO server
 Home-page: https://github.com/CybercentreCanada/assemblyline-ui/
 Author: CCCS Assemblyline development team
 Author-email: assemblyline@cyber.gc.ca
 License: MIT
 Keywords: assemblyline automated malware analysis gc canada cse-cst cse cst cyber cccs
 Classifier: Development Status :: 5 - Production/Stable
```

## Comparing `assemblyline_ui-4.5.1.dev80.dist-info/RECORD` & `assemblyline_ui-4.5.1.dev81.dist-info/RECORD`

 * *Files 2% similar despite different names*

```diff
@@ -1,11 +1,11 @@
-assemblyline_ui/VERSION,sha256=T95_7YLJ_Z2SHGF6YMb5pkFT_33vnwasmXwhTgwwkmw,12
+assemblyline_ui/VERSION,sha256=KLSp4dUn9ibfFBcnwi3EZY1MOKN36KdS-t-_s4zSQqA,12
 assemblyline_ui/__init__.py,sha256=47DEQpj8HBSa-_TImW-5JCeuQeRkm5NMpJWZG3hSuFU,0
 assemblyline_ui/app.py,sha256=9JB-hkhReF2jLUUMe3F01dvN9i2HnRFGydvQCXBkE1U,6736
-assemblyline_ui/config.py,sha256=o5V97C6WbfzXbwtrhR8k04G20q_NdnFn70MdYxvgsYA,5957
+assemblyline_ui/config.py,sha256=-b1Qv3SQ5tzuquULldJo5BEFKrF44zVbqFgawB66D3Y,5951
 assemblyline_ui/error.py,sha256=vqP9pT375oQSoWy2mMR2pNxz2YzBthpO0icxW2oO_YU,3690
 assemblyline_ui/gunicorn_config.py,sha256=qm2Ehn9nY_yH6Klp2acYFZ9jC7St9hSmXIW42WRXbc4,740
 assemblyline_ui/gunicorn_config_socketio.py,sha256=WWAWzrZOw1OXEiV_nNMKf-wH6A0Ckio2juCYWu-QfAE,115
 assemblyline_ui/healthz.py,sha256=IFr2ofSddFX8pvoixMmZHSlk364oKD_vURl_GRT6J2s,777
 assemblyline_ui/http_exceptions.py,sha256=5DvpspLyuE6fQfR6mpPmQiFDXahr2vr3uuTp7S9Guy8,199
 assemblyline_ui/logger.py,sha256=dgaAzJc39ajD1e3hipc291zqcHyCXMgdDSLzz6V-Jus,2322
 assemblyline_ui/patched.py,sha256=EkYqCoW64CuZvrZjE7xNwZ9bTaiVfwuYBbVUR64g42A,85
@@ -47,18 +47,18 @@
 assemblyline_ui/helper/oauth.py,sha256=D_1f6jd0rhwwMXi4qAieFcqAIpWXOb82oeZr0Zds3lI,8154
 assemblyline_ui/helper/result.py,sha256=u79F3IKN1EcVOkfk1CvQNEwbIWyiq9Wj8OHp3zuwmBc,4926
 assemblyline_ui/helper/search.py,sha256=QdzHgQCzpLCcq2N2auGAK9GDWC3B3V51Vey-BjGRZ6M,1686
 assemblyline_ui/helper/service.py,sha256=75kdOvWBprCi9h42FtoxDUsuKhnD-rh4f3W-y3q8RU0,3260
 assemblyline_ui/helper/signature.py,sha256=PUiQk56QoY5Ye2Pg3jRNgOT2i2ZqTWkk_0dv-Bfy9vI,899
 assemblyline_ui/helper/submission.py,sha256=P4Ff9ps_nUzHxBE7486_xbyUNuXTvOYU3aWdK8VyBOY,6835
 assemblyline_ui/helper/user.py,sha256=40ze4dNudQR-TLgf5CB1_x_Iu-5bsRiu4gVTDvsktxw,7628
-assemblyline_ui/helper/ai/__init__.py,sha256=p86bsguyeRSC1YJXiMjS-dbMhpjQx8gJvvF5cRrN_As,443
-assemblyline_ui/helper/ai/base.py,sha256=krqblQE_CmV4ExOSu9lfR8EPKIIFPlpZ5wNLtgGxBIY,895
-assemblyline_ui/helper/ai/cohere.py,sha256=2PHpJKNOXQTg8TCjdyNNKg4tKcKTYe_KougCSVx5sS0,5569
-assemblyline_ui/helper/ai/openai.py,sha256=hjxA8hz89AVGwB0shGmY6J2GXPV0fGAVayjy-s5M30s,5267
+assemblyline_ui/helper/ai/__init__.py,sha256=At7cPA5v4EI07QT95qihEnGMlKn-AVawMNnX6FmUrvY,445
+assemblyline_ui/helper/ai/base.py,sha256=GFKdXtmqUGE2hjxCtX-zR0BMYcPWcrR3MEgIS-WBHng,4895
+assemblyline_ui/helper/ai/cohere.py,sha256=RejpLnTykVT_U61-DqM_WsMmmi91BkeSkkqEOruRA98,5692
+assemblyline_ui/helper/ai/openai.py,sha256=6AdkWe6tIEEKXUbBpmobTXNuVA-H49DU0RVI1OxAejc,5446
 assemblyline_ui/security/__init__.py,sha256=47DEQpj8HBSa-_TImW-5JCeuQeRkm5NMpJWZG3hSuFU,0
 assemblyline_ui/security/apikey_auth.py,sha256=TDESuSgEEkxWZEm2X0vW1t96uWXMKCvAeJBaXnzZKQc,1410
 assemblyline_ui/security/authenticator.py,sha256=Pjuo6VL2QrI4YL1NDAAxURv_8CYo7bwbNbDhOkLiphk,10116
 assemblyline_ui/security/ldap_auth.py,sha256=2HQh3krpPSRRCLVfow_JP_TERNeV6YLtpXOXGNzFm9Q,13749
 assemblyline_ui/security/oauth_auth.py,sha256=hfyOxNacDSh0OuovDzclsi4eCzk08-h1Y10V4QF-O_0,3074
 assemblyline_ui/security/second_factor_auth.py,sha256=GiJNoL_CjDPAHml0VdcK46GfYzkqYuAkOdW9PIorXYs,2951
 assemblyline_ui/security/userpass_auth.py,sha256=vfG9K_jpdigpZolUmkc_cEtfZ5DgPdLW7V5g68CAsVA,750
@@ -66,12 +66,12 @@
 assemblyline_ui/sio/alert.py,sha256=aTtrkZW21igbP6UcFgo1_fXdF8RpCBlMiKsNdpwItZw,2170
 assemblyline_ui/sio/base.py,sha256=TLSoCLqxvSEFuggmCscnzAY1E60rweIIZLr0ai8jm5M,3529
 assemblyline_ui/sio/file.py,sha256=UMtE7mE7EcbG6KN8HBMQSvv5N7PILCq8nVnrngOnBso,2041
 assemblyline_ui/sio/live_submission.py,sha256=mS0oGO5rEA8PLa8kjBcodOG-Q0CG4SpYAoi8bz9_PCw,4158
 assemblyline_ui/sio/retrohunt.py,sha256=vlH_x6Rb4pm3GM1sNLH1C42-NVR3VoAsEfkAu3L30fY,2146
 assemblyline_ui/sio/status.py,sha256=_Bxf1KLPOJEUIk4J9_j9fzvQWUXqSIT9xnJKhT1hhuc,1980
 assemblyline_ui/sio/submission.py,sha256=IYJuGz73HK9HtYfqc-gWW8tc1lt5VZ62Qn64AaGGtm8,2222
-assemblyline_ui-4.5.1.dev80.dist-info/LICENCE.md,sha256=NSkYo9EH8h5oOkzg4VhjAHF4339MqPP2cQ8msTPgl-c,1396
-assemblyline_ui-4.5.1.dev80.dist-info/METADATA,sha256=06YSAXIEznrpuIKg1hyV3F2J263LPtA6ZSRXo8CyY9s,2898
-assemblyline_ui-4.5.1.dev80.dist-info/WHEEL,sha256=GJ7t_kWBFywbagK5eo9IoUwLW6oyOeTKmQ-9iHFVNxQ,92
-assemblyline_ui-4.5.1.dev80.dist-info/top_level.txt,sha256=WLa7-PKLJTbMUbKKU3q3kg5_uAV67hss5kC71PAbIeg,16
-assemblyline_ui-4.5.1.dev80.dist-info/RECORD,,
+assemblyline_ui-4.5.1.dev81.dist-info/LICENCE.md,sha256=NSkYo9EH8h5oOkzg4VhjAHF4339MqPP2cQ8msTPgl-c,1396
+assemblyline_ui-4.5.1.dev81.dist-info/METADATA,sha256=6zP4zyBZajh0k34w7jKbVXlGk3V6tj1lLH5sB0w8XgQ,2898
+assemblyline_ui-4.5.1.dev81.dist-info/WHEEL,sha256=GJ7t_kWBFywbagK5eo9IoUwLW6oyOeTKmQ-9iHFVNxQ,92
+assemblyline_ui-4.5.1.dev81.dist-info/top_level.txt,sha256=WLa7-PKLJTbMUbKKU3q3kg5_uAV67hss5kC71PAbIeg,16
+assemblyline_ui-4.5.1.dev81.dist-info/RECORD,,
```

