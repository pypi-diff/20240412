# Comparing `tmp/ip_check-1.5.8-py3-none-any.whl.zip` & `tmp/ip_check-1.5.9-py3-none-any.whl.zip`

## zipinfo {}

```diff
@@ -1,32 +1,32 @@
-Zip file size: 38441 bytes, number of entries: 30
+Zip file size: 38794 bytes, number of entries: 30
 -rw-rw-r--  2.0 unx      383 b- defN 24-Mar-19 08:00 ipcheck/__init__.py
 -rw-rw-r--  2.0 unx     6208 b- defN 24-Apr-11 01:20 ipcheck/geoinfo.py
--rw-rw-r--  2.0 unx    10601 b- defN 24-Apr-11 02:09 ipcheck/main.py
+-rw-rw-r--  2.0 unx    10949 b- defN 24-Apr-12 06:40 ipcheck/main.py
 -rw-rw-r--  2.0 unx        0 b- defN 24-Mar-14 08:04 ipcheck/app/__init__.py
 -rw-rw-r--  2.0 unx      726 b- defN 24-Mar-14 08:04 ipcheck/app/base_config.py
--rw-rw-r--  2.0 unx      462 b- defN 24-Apr-11 02:07 ipcheck/app/common_config.py
--rw-rw-r--  2.0 unx     6149 b- defN 24-Apr-11 01:20 ipcheck/app/config.py
+-rw-rw-r--  2.0 unx      462 b- defN 24-Apr-11 06:34 ipcheck/app/common_config.py
+-rw-rw-r--  2.0 unx     6182 b- defN 24-Apr-12 06:34 ipcheck/app/config.py
 -rw-rw-r--  2.0 unx     1773 b- defN 24-Mar-19 08:00 ipcheck/app/default_config.py
 -rw-rw-r--  2.0 unx     2193 b- defN 24-Apr-11 01:20 ipcheck/app/gen_ip_utils.py
--rw-rw-r--  2.0 unx     2078 b- defN 24-Apr-11 02:11 ipcheck/app/ip_info.py
+-rw-rw-r--  2.0 unx     2078 b- defN 24-Apr-11 06:34 ipcheck/app/ip_info.py
 -rw-rw-r--  2.0 unx     2546 b- defN 24-Mar-14 08:04 ipcheck/app/rtt_test.py
 -rw-rw-r--  2.0 unx      223 b- defN 24-Mar-14 08:04 ipcheck/app/rtt_test_config.py
 -rw-rw-r--  2.0 unx     5656 b- defN 24-Apr-09 08:53 ipcheck/app/speed_test.py
 -rw-rw-r--  2.0 unx      223 b- defN 24-Mar-14 08:04 ipcheck/app/speed_test_config.py
 -rw-rw-r--  2.0 unx     3149 b- defN 24-Apr-11 01:20 ipcheck/app/utils.py
 -rw-rw-r--  2.0 unx     3765 b- defN 24-Apr-11 01:20 ipcheck/app/valid_test.py
 -rw-rw-r--  2.0 unx      362 b- defN 24-Apr-09 08:53 ipcheck/app/valid_test_config.py
 -rw-rw-r--  2.0 unx        0 b- defN 24-Apr-09 08:53 ipcheck/app/ipparser/__init__.py
--rw-rw-r--  2.0 unx      954 b- defN 24-Apr-11 01:20 ipcheck/app/ipparser/base_parser.py
+-rw-rw-r--  2.0 unx     1058 b- defN 24-Apr-12 07:35 ipcheck/app/ipparser/base_parser.py
 -rw-rw-r--  2.0 unx      673 b- defN 24-Apr-11 01:20 ipcheck/app/ipparser/ip_cidr_parser.py
 -rw-rw-r--  2.0 unx      835 b- defN 24-Apr-11 01:20 ipcheck/app/ipparser/ip_dir_parser.py
--rw-rw-r--  2.0 unx     1138 b- defN 24-Apr-11 01:20 ipcheck/app/ipparser/ip_file_parser.py
+-rw-rw-r--  2.0 unx     1138 b- defN 24-Apr-12 07:02 ipcheck/app/ipparser/ip_file_parser.py
 -rw-rw-r--  2.0 unx      526 b- defN 24-Apr-11 01:20 ipcheck/app/ipparser/ip_parser.py
--rw-rw-r--  2.0 unx     1078 b- defN 24-Apr-11 01:20 ipcheck/app/ipparser/ip_port_parser.py
--rw-rw-r--  2.0 unx    35148 b- defN 24-Apr-11 03:09 ip_check-1.5.8.dist-info/LICENSE
--rw-rw-r--  2.0 unx     5914 b- defN 24-Apr-11 03:09 ip_check-1.5.8.dist-info/METADATA
--rw-rw-r--  2.0 unx       92 b- defN 24-Apr-11 03:09 ip_check-1.5.8.dist-info/WHEEL
--rw-r--r--  2.0 unx      201 b- defN 24-Apr-11 03:09 ip_check-1.5.8.dist-info/entry_points.txt
--rw-r--r--  2.0 unx        8 b- defN 24-Apr-11 03:09 ip_check-1.5.8.dist-info/top_level.txt
-?rw-rw-r--  2.0 unx     2507 b- defN 24-Apr-11 03:09 ip_check-1.5.8.dist-info/RECORD
-30 files, 95571 bytes uncompressed, 34397 bytes compressed:  64.0%
+-rw-rw-r--  2.0 unx     1407 b- defN 24-Apr-12 07:34 ipcheck/app/ipparser/ip_port_parser.py
+-rw-rw-r--  2.0 unx    35148 b- defN 24-Apr-12 07:49 ip_check-1.5.9.dist-info/LICENSE
+-rw-rw-r--  2.0 unx     6361 b- defN 24-Apr-12 07:49 ip_check-1.5.9.dist-info/METADATA
+-rw-rw-r--  2.0 unx       92 b- defN 24-Apr-12 07:49 ip_check-1.5.9.dist-info/WHEEL
+-rw-r--r--  2.0 unx      201 b- defN 24-Apr-12 07:49 ip_check-1.5.9.dist-info/entry_points.txt
+-rw-r--r--  2.0 unx        8 b- defN 24-Apr-12 07:49 ip_check-1.5.9.dist-info/top_level.txt
+?rw-rw-r--  2.0 unx     2508 b- defN 24-Apr-12 07:49 ip_check-1.5.9.dist-info/RECORD
+30 files, 96833 bytes uncompressed, 34750 bytes compressed:  64.1%
```

## zipnote {}

```diff
@@ -66,26 +66,26 @@
 
 Filename: ipcheck/app/ipparser/ip_parser.py
 Comment: 
 
 Filename: ipcheck/app/ipparser/ip_port_parser.py
 Comment: 
 
-Filename: ip_check-1.5.8.dist-info/LICENSE
+Filename: ip_check-1.5.9.dist-info/LICENSE
 Comment: 
 
-Filename: ip_check-1.5.8.dist-info/METADATA
+Filename: ip_check-1.5.9.dist-info/METADATA
 Comment: 
 
-Filename: ip_check-1.5.8.dist-info/WHEEL
+Filename: ip_check-1.5.9.dist-info/WHEEL
 Comment: 
 
-Filename: ip_check-1.5.8.dist-info/entry_points.txt
+Filename: ip_check-1.5.9.dist-info/entry_points.txt
 Comment: 
 
-Filename: ip_check-1.5.8.dist-info/top_level.txt
+Filename: ip_check-1.5.9.dist-info/top_level.txt
 Comment: 
 
-Filename: ip_check-1.5.8.dist-info/RECORD
+Filename: ip_check-1.5.9.dist-info/RECORD
 Comment: 
 
 Zip file comment:
```

## ipcheck/main.py

```diff
@@ -37,14 +37,15 @@
 
 # 从手动参数中覆盖默认config
 def load_config():
     parser = argparse.ArgumentParser(description='ip-check 参数')
     parser.add_argument("-w", "--white_list", type=parse_list, default=None, help='偏好ip参数, 格式为: "expr1,expr2", 如"8,9" 会筛选8和9开头的ip')
     parser.add_argument("-b", "--block_list", type=parse_list, default=None, help='屏蔽ip参数, 格式为: "expr1,expr2", 如"8,9" 会过滤8和9开头的ip')
     parser.add_argument("-pl", "--prefer_locs", type=parse_list, default=None, help='偏好国家地区选择, 格式为: "expr1,expr2", 如"hongkong,japan" 会筛选HongKong 和Japan 地区的ip')
+    parser.add_argument("-pp", "--prefer_ports", type=parse_list, default=None, help='针对ip:port 格式的测试源筛选端口, 格式为: "expr1,expr2", 如"443,8443" 会筛选出443 和8443 端口的ip')
     parser.add_argument("-lv", "--max_vt_ip_count", type=int, default=0, help="最大用来检测有效(valid) ip数量限制,0表示使用config.ini中的配置")
     parser.add_argument("-lr", "--max_rt_ip_count", type=int, default=0, help="最大用来检测rtt ip数量限制,0表示使用config.ini中的配置")
     parser.add_argument("-ls", "--max_st_ip_count", type=int, default=0, help="最大用来检测下载(speed) 速度的ip数量限制,0表示使用config.ini中的配置")
     parser.add_argument("-p", "--port", type=int, default=0, help="用来检测的端口")
     parser.add_argument("-H", "--host", type=str, default=None, help="可用性域名")
     parser.add_argument("-dr", "--disable_rt", action="store_true", default=False, help="是否禁用RTT 测试")
     parser.add_argument("-dv", "--disable_vt", action="store_true", default=False, help="是否禁用可用性测试")
@@ -87,14 +88,17 @@
         config.white_list = white_list
     if block_list:
         print('黑名单参数为:', block_list)
         config.block_list = block_list
     config.prefer_locs = args.prefer_locs
     if config.prefer_locs:
         print('优选地区参数为:', config.prefer_locs)
+    config.prefer_ports = args.prefer_ports
+    if config.prefer_ports:
+        print('ip:port 测试源端口为:', config.prefer_ports)
     if args.disable_vt:
         print('可用性检测已关闭')
         config.vt_enabled = False
     if args.disable_rt:
         print('rtt 测试已关闭')
         config.rt_enabled = False
     if args.disable_st:
```

## ipcheck/app/config.py

```diff
@@ -43,14 +43,15 @@
         # 测试ip 源, 可选ip、ip cidr、文本(读取ip、ip cidr)、zip 压缩包(遍历其中的txt 文本，读取ip、ip cidr)
         self.ip_source = None
         self.out_file = None
         self.verbose = None
         self.white_list = None
         self.block_list = None
         self.prefer_locs = None
+        self.prefer_ports = None
 
         # 可用性valid test测试选项
         # 是否测试可用性
         self.vt_enabled = True
         # 限制参与valid 测试的ip 数量
         self.vt_ip_limit_count = 1500
         # 可用性检测域名
```

## ipcheck/app/ipparser/base_parser.py

```diff
@@ -9,15 +9,15 @@
 
     def __init__(self, source: str) -> None:
         self.source = source
         self.port = Config().ip_port
 
     @property
     def is_valid(self) -> bool:
-        return self.check_source_type() and self.is_source_valid()
+        return self.check_source_type() and self.is_source_valid() and self.extra_check()
 
     def parse(self) -> List[IpInfo]:
         return []
 
     def check_source_type(self) -> bool:
         return False
 
@@ -28,8 +28,12 @@
                     return True
             return False
         if Config().block_list:
             for expr_str in Config().block_list:
                 if self.source.startswith(expr_str):
                     return False
             return True
+        return True
+
+    # 额外判断项目
+    def extra_check(self) -> bool:
         return True
```

### encoding

```diff
@@ -1 +1 @@
-us-ascii
+utf-8
```

## ipcheck/app/ipparser/ip_port_parser.py

```diff
@@ -1,11 +1,12 @@
 #!/usr/bin/env python3
 # -*- coding: utf-8 -*-
 
 from typing import List
+from ipcheck.app.config import Config
 from ipcheck.app.ip_info import IpInfo
 from ipcheck.app.ipparser.base_parser import BaseParser
 from ipcheck.app.utils import is_valid_port, is_ip_address
 
 class IpPortParser(BaseParser):
     '''
     解析ip:port 格式
@@ -31,8 +32,19 @@
         return False
 
 
     def parse(self) -> List[IpInfo]:
         ip_list = []
         if self.is_valid:
             ip_list.append(IpInfo(self.ip, self.port))
-        return ip_list
+        return ip_list
+
+        # IpPortParser use only
+    def extra_check(self) -> bool:
+        port_str = str(self.port)
+        res = False
+        prefer_ports = Config().prefer_ports
+        if prefer_ports:
+            res = port_str in prefer_ports
+        else:
+            res = True
+        return res
```

## Comparing `ip_check-1.5.8.dist-info/LICENSE` & `ip_check-1.5.9.dist-info/LICENSE`

 * *Files identical despite different names*

## Comparing `ip_check-1.5.8.dist-info/METADATA` & `ip_check-1.5.9.dist-info/METADATA`

 * *Files 6% similar despite different names*

```diff
@@ -1,10 +1,10 @@
 Metadata-Version: 2.1
 Name: ip-check
-Version: 1.5.8
+Version: 1.5.9
 Summary: Powerful cdn network speed test utils.
 Author: nobitaqaq
 Author-email: xiaoleigs@gmail.com
 Keywords: cdn,speed test,network speed
 Requires-Python: >=3.8
 Description-Content-Type: text/markdown
 License-File: LICENSE
@@ -26,16 +26,17 @@
 pip install ip-check --upgrade
 ```
 
 ## 使用方法
 
 ```shell
 ip-check --help
-usage: ip-check [-h] [-w WHITE_LIST] [-b BLOCK_LIST] [-lv MAX_VT_IP_COUNT] [-lr MAX_RT_IP_COUNT] [-ls MAX_ST_IP_COUNT] [-p PORT] [-dr] [-dv] [-ds]
-                [-o OUTPUT] [-f] [-s SPEED] [-r RTT] [-l LOSS] [-c CONFIG] [-v] [-ns] [--version]
+usage: ip-check [-h] [-w WHITE_LIST] [-b BLOCK_LIST] [-pl PREFER_LOCS] [-pp PREFER_PORTS] [-lv MAX_VT_IP_COUNT] [-lr MAX_RT_IP_COUNT]
+                [-ls MAX_ST_IP_COUNT] [-p PORT] [-H HOST] [-dr] [-dv] [-ds] [-o OUTPUT] [-f] [-s SPEED] [-r RTT] [-l LOSS] [-c CONFIG] [-v] [-ns]
+                [--version]
                 source [source ...]
 
 ip-check 参数
 
 positional arguments:
   source                测试源文件
 
@@ -43,14 +44,16 @@
   -h, --help            show this help message and exit
   -w WHITE_LIST, --white_list WHITE_LIST
                         偏好ip参数, 格式为: "expr1,expr2", 如"8,9" 会筛选8和9开头的ip
   -b BLOCK_LIST, --block_list BLOCK_LIST
                         屏蔽ip参数, 格式为: "expr1,expr2", 如"8,9" 会过滤8和9开头的ip
   -pl PREFER_LOCS, --prefer_locs PREFER_LOCS
                         偏好国家地区选择, 格式为: "expr1,expr2", 如"hongkong,japan" 会筛选HongKong 和Japan 地区的ip
+  -pp PREFER_PORTS, --prefer_ports PREFER_PORTS
+                        针对ip:port 格式的测试源筛选端口, 格式为: "expr1,expr2", 如"443,8443" 会筛选出443 和8443 端口的ip
   -lv MAX_VT_IP_COUNT, --max_vt_ip_count MAX_VT_IP_COUNT
                         最大用来检测有效(valid) ip数量限制,0表示使用config.ini中的配置
   -lr MAX_RT_IP_COUNT, --max_rt_ip_count MAX_RT_IP_COUNT
                         最大用来检测rtt ip数量限制,0表示使用config.ini中的配置
   -ls MAX_ST_IP_COUNT, --max_st_ip_count MAX_ST_IP_COUNT
                         最大用来检测下载(speed) 速度的ip数量限制,0表示使用config.ini中的配置
   -p PORT, --port PORT  用来检测的端口
@@ -98,14 +101,16 @@
 ip-check test.txt -w "8.222,8.223"
 # ip 厌恶，假设你不喜欢13和14 开头的ip
 ip-check test.txt -b "13,14"
 # ip 厌恶，假设你不喜欢131.13和131.14 开头的ip
 ip-check test.txt -b "131.13,131.14"
 # 按地区筛选ip
 ip-check test.txt -pl "japan,hongkong"
+# ip:port 格式的测试源只测试端口为8443 的测试源
+ip-check 7.8.9.10:443 7.8.9.10:8443 -pp 8443
 
 # 指定测试端口，缺省为443
 ip-check test.txt -p 8443
 
 # 指定输出文件，默认为result 与源文件的拼接
 ip-check test.txt -o better-ips.txt
 
@@ -179,14 +184,17 @@
 
 optional arguments:
   -h, --help  show this help message and exit
 ```
 
 ## Release Note
 
+- V1.5.9
+  - 针对多端口测试源增加通过端口筛选测试源的策略
+
 - V1.5.8
   - 修复rtt 测试中丢包率控制失效问题
 
 - V1.5.7
   - 增加按地区优选ip 策略
   - 修复黑白名单不支持多分组策略
```

## Comparing `ip_check-1.5.8.dist-info/RECORD` & `ip_check-1.5.9.dist-info/RECORD`

 * *Files 11% similar despite different names*

```diff
@@ -1,30 +1,30 @@
 ipcheck/__init__.py,sha256=mjRHWAo73u50fxwseCRsTdvj9pPNZuTmsKW8Qpj-cNk,383
 ipcheck/geoinfo.py,sha256=SF6jmsKEMj7MMqfPn70LoJvqm4wy8SC0bpcSZuWfcfo,6208
-ipcheck/main.py,sha256=I_mH5KLjc9mV-pZ_L3m5zHKhTsshtpvvXJS2FSL_v0U,10601
+ipcheck/main.py,sha256=FVjG0MpUJKCt8QxHsq9Qkfr1XPodv0NkN3UDB2k9KFQ,10949
 ipcheck/app/__init__.py,sha256=47DEQpj8HBSa-_TImW-5JCeuQeRkm5NMpJWZG3hSuFU,0
 ipcheck/app/base_config.py,sha256=PxNW4PXHagvULNc9FgDwMtu7aCn91RYx2SqBYd4-nd4,726
 ipcheck/app/common_config.py,sha256=mCaZ6Hc46WQZFuaWSf2wY8s6ux0V7e7nPyomrp0jW6k,462
-ipcheck/app/config.py,sha256=3rEVD67w4bKYsU_zw5FDANisTE-zu6DkGq0auTQ5R5s,6149
+ipcheck/app/config.py,sha256=lKVVqljrGmG7z5T_iq0zEtaZLee-dSJzRnLo85kAHhI,6182
 ipcheck/app/default_config.py,sha256=7OP6pibA78-xkmVGZ4kLsmWzV8fKRff8bCXd9sceFPU,1773
 ipcheck/app/gen_ip_utils.py,sha256=OSDu-OIwydyBrBn3bcH7CyDo0q1b_wMEdGQvWmBVmCc,2193
 ipcheck/app/ip_info.py,sha256=AzAUCV_wY8lgQOAce10AT8NtLPAnFxWr3-IcS5oWXo4,2078
 ipcheck/app/rtt_test.py,sha256=d1_iC3OFeqBAFqqHBdRN_IH5jlRgtd5USn0vV0_CM8M,2546
 ipcheck/app/rtt_test_config.py,sha256=PK7M7uLst4Zi3v2DgKA8rfpZsXIRnwfTxYa12bPDeb8,223
 ipcheck/app/speed_test.py,sha256=LKolSAPbkIkDrfJyW5fVHlMzWuGXaPOckat6S8kqebY,5656
 ipcheck/app/speed_test_config.py,sha256=Ji1jUEqSjAIqkzUzeE1BBHPfoJ2E-JeG36DJiHJ3CYA,223
 ipcheck/app/utils.py,sha256=xXc_6aCN4-lRZ5fUOc4g6cmy3_E1jWhwTWp_X8z625I,3149
 ipcheck/app/valid_test.py,sha256=BIrC1P8_B1fATRzueWRRaQPWFmuFcPT_uDXOEfLuJzs,3765
 ipcheck/app/valid_test_config.py,sha256=akRLXfL1XAFVwIQKvszMRj9TfdI1oQkob3HUEr_grvQ,362
 ipcheck/app/ipparser/__init__.py,sha256=47DEQpj8HBSa-_TImW-5JCeuQeRkm5NMpJWZG3hSuFU,0
-ipcheck/app/ipparser/base_parser.py,sha256=owfTs_Yd7i0yVUQAuj_dFP0jZRjqK1CefKeMNnqX3mc,954
+ipcheck/app/ipparser/base_parser.py,sha256=kIbAKAPV9fE6g2cHj9HQAgDhGPQ6nbE5kGdYLa9Y_1Y,1058
 ipcheck/app/ipparser/ip_cidr_parser.py,sha256=N1z0YycVvizUBRpuvvgQ5YjPv5VPA3npQZfEOawGTzE,673
 ipcheck/app/ipparser/ip_dir_parser.py,sha256=KZnmBh5JArVVuumb9WoIt-iYp6LAYeqbOmmFVUFaop8,835
 ipcheck/app/ipparser/ip_file_parser.py,sha256=HFt7gPZz5miGtX5TGoT5GuJTOagdSCA5TJuNeiV60Xg,1138
 ipcheck/app/ipparser/ip_parser.py,sha256=gE5mLxEMzoEkMKn9n_QIalIrkGCbw9tm9XdKbOtnZWs,526
-ipcheck/app/ipparser/ip_port_parser.py,sha256=Q88_q7RJfPM58DtPyMCduymncBUPWsJTZZ5Ates6ZZM,1078
-ip_check-1.5.8.dist-info/LICENSE,sha256=ixuiBLtpoK3iv89l7ylKkg9rs2GzF9ukPH7ynZYzK5s,35148
-ip_check-1.5.8.dist-info/METADATA,sha256=_2E1zOA6k8xJB2QbDtDgxuOF7WQYlxjI-AEJa4eGU_o,5914
-ip_check-1.5.8.dist-info/WHEEL,sha256=G16H4A3IeoQmnOrYV4ueZGKSjhipXx8zc8nu9FGlvMA,92
-ip_check-1.5.8.dist-info/entry_points.txt,sha256=LbstGY5z6sejWLCwyd9pTq4qRdfCsligLhJHjwp-Pd0,201
-ip_check-1.5.8.dist-info/top_level.txt,sha256=24binHFMOV_-4WIWZrtgRz4y7uY3vUxlJBq2UXMMfvY,8
-ip_check-1.5.8.dist-info/RECORD,,
+ipcheck/app/ipparser/ip_port_parser.py,sha256=zn-W0-Cueb18O2d3-gW0M9B36Xm4XHk1xrcdL2dcfa4,1407
+ip_check-1.5.9.dist-info/LICENSE,sha256=ixuiBLtpoK3iv89l7ylKkg9rs2GzF9ukPH7ynZYzK5s,35148
+ip_check-1.5.9.dist-info/METADATA,sha256=Xikd4GQgkf96eBTkHFlUmEn89Js2yoHu5cUXweDgaM4,6361
+ip_check-1.5.9.dist-info/WHEEL,sha256=G16H4A3IeoQmnOrYV4ueZGKSjhipXx8zc8nu9FGlvMA,92
+ip_check-1.5.9.dist-info/entry_points.txt,sha256=LbstGY5z6sejWLCwyd9pTq4qRdfCsligLhJHjwp-Pd0,201
+ip_check-1.5.9.dist-info/top_level.txt,sha256=24binHFMOV_-4WIWZrtgRz4y7uY3vUxlJBq2UXMMfvY,8
+ip_check-1.5.9.dist-info/RECORD,,
```

