# Comparing `tmp/wakautosolver-2024.4.6-py3-none-any.whl.zip` & `tmp/wakautosolver-2024.4.7-py3-none-any.whl.zip`

## zipinfo {}

```diff
@@ -1,33 +1,35 @@
-Zip file size: 2006219 bytes, number of entries: 31
+Zip file size: 2095485 bytes, number of entries: 33
 -rw-r--r--  2.0 fat    16725 b- defN 20-Feb-02 00:00 LICENSE
 -rw-r--r--  2.0 fat   453356 b- defN 20-Feb-02 00:00 .venv/Lib/site-packages/scripts/item_data.bz2
--rw-r--r--  2.0 fat   137411 b- defN 20-Feb-02 00:00 .venv/Lib/site-packages/scripts/locale_bundle.bz2
+-rw-r--r--  2.0 fat   137716 b- defN 20-Feb-02 00:00 .venv/Lib/site-packages/wakautosolver/data/locale_bundle.bz2
+-rw-r--r--  2.0 fat     3178 b- defN 20-Feb-02 00:00 .venv/Lib/site-packages/wakautosolver/data/source_info.bz2
+-rw-r--r--  2.0 fat    85259 b- defN 20-Feb-02 00:00 .venv/Lib/site-packages/wakautosolver/data/stat_only_bundle.bz2
 -rw-r--r--  2.0 fat   453356 b- defN 20-Feb-02 00:00 scripts/item_data.bz2
 -rw-r--r--  2.0 fat      569 b- defN 20-Feb-02 00:00 wakautosolver/__init__.py
 -rw-r--r--  2.0 fat      764 b- defN 20-Feb-02 00:00 wakautosolver/__main__.py
--rw-r--r--  2.0 fat     3851 b- defN 20-Feb-02 00:00 wakautosolver/_build_codes.py
--rw-r--r--  2.0 fat     1274 b- defN 20-Feb-02 00:00 wakautosolver/_short_debug_info.py
--rw-r--r--  2.0 fat     1713 b- defN 20-Feb-02 00:00 wakautosolver/_typing_memes.py
--rw-r--r--  2.0 fat     4466 b- defN 20-Feb-02 00:00 wakautosolver/item_conditions.py
--rw-r--r--  2.0 fat    11415 b- defN 20-Feb-02 00:00 wakautosolver/object_parsing.py
+-rw-r--r--  2.0 fat     3852 b- defN 20-Feb-02 00:00 wakautosolver/_build_codes.py
+-rw-r--r--  2.0 fat     1275 b- defN 20-Feb-02 00:00 wakautosolver/_short_debug_info.py
+-rw-r--r--  2.0 fat     1714 b- defN 20-Feb-02 00:00 wakautosolver/_typing_memes.py
+-rw-r--r--  2.0 fat     4467 b- defN 20-Feb-02 00:00 wakautosolver/item_conditions.py
+-rw-r--r--  2.0 fat    11416 b- defN 20-Feb-02 00:00 wakautosolver/object_parsing.py
 -rw-r--r--  2.0 fat        0 b- defN 20-Feb-02 00:00 wakautosolver/py.typed
--rw-r--r--  2.0 fat    17069 b- defN 20-Feb-02 00:00 wakautosolver/restructured_types.py
--rw-r--r--  2.0 fat    53178 b- defN 20-Feb-02 00:00 wakautosolver/solver.py
--rw-r--r--  2.0 fat      674 b- defN 20-Feb-02 00:00 wakautosolver/utils.py
--rw-r--r--  2.0 fat    12989 b- defN 20-Feb-02 00:00 wakautosolver/versioned_entrypoints.py
--rw-r--r--  2.0 fat     7331 b- defN 20-Feb-02 00:00 wakautosolver/wakforge_buildcodes.py
+-rw-r--r--  2.0 fat    17342 b- defN 20-Feb-02 00:00 wakautosolver/restructured_types.py
+-rw-r--r--  2.0 fat    55436 b- defN 20-Feb-02 00:00 wakautosolver/solver.py
+-rw-r--r--  2.0 fat      675 b- defN 20-Feb-02 00:00 wakautosolver/utils.py
+-rw-r--r--  2.0 fat    11314 b- defN 20-Feb-02 00:00 wakautosolver/versioned_entrypoints.py
+-rw-r--r--  2.0 fat     7671 b- defN 20-Feb-02 00:00 wakautosolver/wakforge_buildcodes.py
 -rw-r--r--  2.0 fat      366 b- defN 20-Feb-02 00:00 wakautosolver/b2048/__init__.py
 -rw-r--r--  2.0 fat    49861 b- defN 20-Feb-02 00:00 wakautosolver/b2048/dec_table.py
 -rw-r--r--  2.0 fat    21610 b- defN 20-Feb-02 00:00 wakautosolver/b2048/enc_table.py
--rw-r--r--  2.0 fat     3634 b- defN 20-Feb-02 00:00 wakautosolver/b2048/encoder.py
+-rw-r--r--  2.0 fat     3633 b- defN 20-Feb-02 00:00 wakautosolver/b2048/encoder.py
 -rw-r--r--  2.0 fat  1212416 b- defN 20-Feb-02 00:00 wakautosolver/data/items.db
 -rw-r--r--  2.0 fat  1992029 b- defN 20-Feb-02 00:00 wakautosolver/data/items.sql
 -rw-r--r--  2.0 fat   137716 b- defN 20-Feb-02 00:00 wakautosolver/data/locale_bundle.bz2
 -rw-r--r--  2.0 fat       75 b- defN 20-Feb-02 00:00 wakautosolver/data/readme.md
 -rw-r--r--  2.0 fat     3178 b- defN 20-Feb-02 00:00 wakautosolver/data/source_info.bz2
 -rw-r--r--  2.0 fat    85259 b- defN 20-Feb-02 00:00 wakautosolver/data/stat_only_bundle.bz2
-?rw-r--r--  2.0 fat     6104 b- defN 20-Feb-02 00:00 wakautosolver-2024.4.6.dist-info/METADATA
-?rw-r--r--  2.0 fat       87 b- defN 20-Feb-02 00:00 wakautosolver-2024.4.6.dist-info/WHEEL
-?rw-r--r--  2.0 fat    16725 b- defN 20-Feb-02 00:00 wakautosolver-2024.4.6.dist-info/licenses/LICENSE
-?rw-r--r--  2.0 fat     2713 b- defN 20-Feb-02 00:00 wakautosolver-2024.4.6.dist-info/RECORD
-31 files, 4707914 bytes uncompressed, 2001865 bytes compressed:  57.5%
+?rw-r--r--  2.0 fat     6104 b- defN 20-Feb-02 00:00 wakautosolver-2024.4.7.dist-info/METADATA
+?rw-r--r--  2.0 fat       87 b- defN 20-Feb-02 00:00 wakautosolver-2024.4.7.dist-info/WHEEL
+?rw-r--r--  2.0 fat    16725 b- defN 20-Feb-02 00:00 wakautosolver-2024.4.7.dist-info/licenses/LICENSE
+?rw-r--r--  2.0 fat     2960 b- defN 20-Feb-02 00:00 wakautosolver-2024.4.7.dist-info/RECORD
+33 files, 4798104 bytes uncompressed, 2090715 bytes compressed:  56.4%
```

## zipnote {}

```diff
@@ -1,14 +1,20 @@
 Filename: LICENSE
 Comment: 
 
 Filename: .venv/Lib/site-packages/scripts/item_data.bz2
 Comment: 
 
-Filename: .venv/Lib/site-packages/scripts/locale_bundle.bz2
+Filename: .venv/Lib/site-packages/wakautosolver/data/locale_bundle.bz2
+Comment: 
+
+Filename: .venv/Lib/site-packages/wakautosolver/data/source_info.bz2
+Comment: 
+
+Filename: .venv/Lib/site-packages/wakautosolver/data/stat_only_bundle.bz2
 Comment: 
 
 Filename: scripts/item_data.bz2
 Comment: 
 
 Filename: wakautosolver/__init__.py
 Comment: 
@@ -75,20 +81,20 @@
 
 Filename: wakautosolver/data/source_info.bz2
 Comment: 
 
 Filename: wakautosolver/data/stat_only_bundle.bz2
 Comment: 
 
-Filename: wakautosolver-2024.4.6.dist-info/METADATA
+Filename: wakautosolver-2024.4.7.dist-info/METADATA
 Comment: 
 
-Filename: wakautosolver-2024.4.6.dist-info/WHEEL
+Filename: wakautosolver-2024.4.7.dist-info/WHEEL
 Comment: 
 
-Filename: wakautosolver-2024.4.6.dist-info/licenses/LICENSE
+Filename: wakautosolver-2024.4.7.dist-info/licenses/LICENSE
 Comment: 
 
-Filename: wakautosolver-2024.4.6.dist-info/RECORD
+Filename: wakautosolver-2024.4.7.dist-info/RECORD
 Comment: 
 
 Zip file comment:
```

## wakautosolver/__init__.py

```diff
@@ -3,15 +3,15 @@
 License, v. 2.0. If a copy of the MPL was not distributed with this
 file, You can obtain one at http://mozilla.org/MPL/2.0/.
 
 Copyright (C) 2023 Michael Hall <https://github.com/mikeshardmind>
 """
 
 # Note: This is Year, month, monotonic not year, month, day
-__version__ = "2024.04.6"
+__version__ = "2024.04.7"
 
 from . import object_parsing, solver
 from .b2048 import decode as b2048_decode
 from .b2048 import encode as b2048_encode
 
 __all__ = [
     "b2048_decode",
```

## wakautosolver/_build_codes.py

```diff
@@ -1,14 +1,15 @@
 """
 This Source Code Form is subject to the terms of the Mozilla Public
 License, v. 2.0. If a copy of the MPL was not distributed with this
 file, You can obtain one at http://mozilla.org/MPL/2.0/.
 
 Copyright (C) 2023 Michael Hall <https://github.com/mikeshardmind>
 """
+
 from __future__ import annotations
 
 # This is an idealized handling that varies a bit from wakforge's. Keeping it for now,
 import enum
 import zlib
 
 from msgspec import Struct, field, msgpack
```

## wakautosolver/_short_debug_info.py

```diff
@@ -1,14 +1,15 @@
 """
 This Source Code Form is subject to the terms of the Mozilla Public
 License, v. 2.0. If a copy of the MPL was not distributed with this
 file, You can obtain one at http://mozilla.org/MPL/2.0/.
 
 Copyright (C) 2023 Michael Hall <https://github.com/mikeshardmind>
 """
+
 from __future__ import annotations
 
 import zlib
 
 from msgspec import Struct, field, msgpack
 
 from . import __version__ as ver
```

## wakautosolver/_typing_memes.py

```diff
@@ -1,14 +1,15 @@
 """
 This Source Code Form is subject to the terms of the Mozilla Public
 License, v. 2.0. If a copy of the MPL was not distributed with this
 file, You can obtain one at http://mozilla.org/MPL/2.0/.
 
 Copyright (C) 2023 Michael Hall <https://github.com/mikeshardmind>
 """
+
 from __future__ import annotations
 
 from typing import Literal
 
 # Imagine having real refinement types...
 # Nah, just let everyone suffer or make libraries do things
 # like this or use annotated for type info.
```

## wakautosolver/item_conditions.py

```diff
@@ -1,14 +1,15 @@
 """
 This Source Code Form is subject to the terms of the Mozilla Public
 License, v. 2.0. If a copy of the MPL was not distributed with this
 file, You can obtain one at http://mozilla.org/MPL/2.0/.
 
 Copyright (C) 2023 Michael Hall <https://github.com/mikeshardmind>
 """
+
 from __future__ import annotations
 
 from collections.abc import Sequence
 from functools import lru_cache, reduce
 from operator import and_
 
 from . import restructured_types as rst
```

## wakautosolver/object_parsing.py

```diff
@@ -1,14 +1,15 @@
 """
 This Source Code Form is subject to the terms of the Mozilla Public
 License, v. 2.0. If a copy of the MPL was not distributed with this
 file, You can obtain one at http://mozilla.org/MPL/2.0/.
 
 Copyright (C) 2023 Michael Hall <https://github.com/mikeshardmind>
 """
+
 from __future__ import annotations
 
 import bz2
 import contextvars
 import pathlib
 from functools import lru_cache
 from typing import Literal, TypedDict
```

## wakautosolver/restructured_types.py

```diff
@@ -124,14 +124,24 @@
     block: int = 0
     fd: float = 0
     heals_performed: int = 0
     lock: int = 0
     dodge: int = 0
     armor_given: int = 0
 
+    def get_secondary_sum(self) -> int:
+        return (
+            self.critical_mastery
+            + self.distance_mastery
+            + self.melee_mastery
+            + self.healing_mastery
+            + self.berserk_mastery
+            + self.rear_mastery
+        )
+
     def __sub__(self, other: object) -> Stats:
         if not isinstance(other, Stats):
             return NotImplemented
 
         return Stats(
             self.ap - other.ap,
             self.mp - other.mp,
```

## wakautosolver/solver.py

```diff
@@ -47,16 +47,15 @@
 log = logging.getLogger("solver")
 
 
 T_contra = TypeVar("T_contra", contravariant=True)
 
 
 class SupportsWrite(Protocol[T_contra]):
-    def write(self, s: T_contra, /) -> object:
-        ...
+    def write(self, s: T_contra, /) -> object: ...
 
 
 ALWAYS_SIMMED = "ap", "mp", "ra", "wp", "critical_hit", "critical_mastery"
 
 
 @only_once
 def setup_logging(output: SupportsWrite[str]) -> None:
@@ -95,14 +94,15 @@
 
 def solve(
     ns: v1Config,
     use_tqdm: bool = False,
     progress_callback: Callable[[int, int], None] | None = None,
     point_spread: StatSpread | None = None,
     passives: list[int] | None = None,
+    sublimations: list[int] | None = None,
 ) -> list[tuple[float, list[EquipableItem]]]:
     """Still has some debug stuff in here, will be refactoring this all later."""
 
     use_tqdm = use_tqdm or bool(os.getenv("USE_TQDM", None))
 
     set_locale(ns.locale)
 
@@ -222,18 +222,43 @@
         ra=ns.basera,
         wp=ns.bawewp,
         critical_hit=ns.bcrit,
         critical_mastery=ns.bcmast,
         elemental_mastery=ns.bmast,
     )
 
+    influence_level = 0
+    if sublimations:
+        for sublimation in sublimations:
+            match sublimation:
+                case 28871:
+                    influence_level += 1
+                case 27152:
+                    influence_level += 2
+                case 28872:
+                    influence_level += 3
+                case 24132:
+                    ns.unraveling = True
+                case 27186:
+                    ns.twoh = True
+                case _:
+                    pass
+
+    base_stats += Stats(critical_hit=3 * min(influence_level, 6))
+
     # STAT MODIFYING PASSIVES
     # Things that unconditionally, and without regard for other stats, modify
     # stat quantities (ie. xelor's memory passive)
 
+    if passives:
+        if 20003 in passives:  # Motivation
+            base_stats += Stats(ap=1, fd=-0.2)
+        if 20006 in passives:  # Carnage
+            base_stats += Stats(fd=0.15)
+
     if ns.wakfu_class == ClassesEnum.Xelor and passives and 756 in passives:  # Memory
         base_stats += Stats(wp=6, mp=-2)
 
     # An interesting query
     # ┌───────────────────────┬────┬────┬────┬────┬──────────────┬───────────────────────────────────┐
     # | Item name (en)        │ ap │ mp │ wp │ ra │   position   │ first ALS bracket combo available │
     # │ Gobball Amulet        │ 1  │ 0  │ 0  │ 0  │ NECK         │ 20                                │
@@ -248,16 +273,14 @@
         "BACK": 20,
         "NECK": 20,
         "FIRST_WEAPON": 50,
         "CHEST": 50,
         "LEGS": 50,
     }
 
-    BASE_STAT_SCORE = _score_key(base_stats)
-
     def item_condition_conflicts_requested_stats(item: EquipableItem) -> bool:
         _mins, maxs = get_item_conditions(item)
         if not maxs:
             return False
         return any(smin > smax for smin, smax in zip(*map(astuple, (stat_mins, maxs))))
 
     def level_filter(item: EquipableItem) -> bool:
@@ -698,14 +721,28 @@
     relics.sort(key=lambda r: (score_key(r), r.item_slot), reverse=True)
     inplace_ordered_keep_by_key(relics, needs_full_sim_key)
     epics.sort(key=lambda e: (score_key(e), e.item_slot), reverse=True)
     inplace_ordered_keep_by_key(epics, needs_full_sim_key)
 
     if ns.lwx:
         solve_DAGGERS.append(EquipableItem(-2, ns.lv, 4, 112, elemental_mastery=int(ns.lv * 1.5)))
+    elif sublimations:
+        c = 0
+        for sub in sublimations:
+            match sub:
+                case 28908:
+                    c += 1
+                case 28807:
+                    c += 2
+                case 28909:
+                    c += 3
+                case _:
+                    pass
+        x = 0.25 * max(c, 6)
+        solve_DAGGERS.append(EquipableItem(-2, ns.lv, 4, 112, elemental_mastery=int(ns.lv * x)))
 
     # Tt be reused below
 
     for item in (*forced_relics, *forced_epics):
         if item.item_type == 112:
             solve_DAGGERS = [item]
         elif item.item_id == 189:
@@ -1057,15 +1094,15 @@
             if ns.wakfu_class == ClassesEnum.Ecaflip and critical_hit > 100:
                 statline += Stats(fd=0.5 * (critical_hit - 100))
 
             # Bravery
             if ns.wakfu_class == ClassesEnum.Iop and passives and 5100 in passives and ns.lv >= 90:
                 block_mod = min(max(0, statline.block // 2), 20)
                 if block_mod:
-                    statline += Stats(critical_hit==block_mod)
+                    statline += Stats(critical_hit == block_mod)
 
             # Sram to the bone
             if ns.wakfu_class == ClassesEnum.Sram and passives and 4610 in passives and ns.lv >= 100:
                 # TODO: (?) We assume shards will make up any missing lock/dodge right now
                 statline += Stats(critical_hit=20 if ns.lv < 200 else 30)
 
             if ns.wakfu_class == ClassesEnum.Masq and passives:
@@ -1077,25 +1114,52 @@
                     distance_mod = min(max(0, ns.lv * 2), ns.lv * 2)
                     statline += Stats(distance_mastery=distance_mod)
 
             UNRAVEL_ACTIVE = ns.unraveling and critical_hit >= 40
 
             crit_chance = max(min(critical_hit, 100), 0)  # engine crit rate vs stat
 
-            base_score = sum(score_key(i) for i in (*items, relic, epic)) + BASE_STAT_SCORE
+            _is = base_stats
+            for item in (*items, relic, epic):
+                if item is not None:
+                    _is += item.as_stats()
+
+            fd_mod = 0
+            if _is.get_secondary_sum() <= 0:
+                if sublimations and 29874 in sublimations:
+                    # inflexibility 2
+                    _is += Stats(
+                        elemental_mastery=int(_is.elemental_mastery * 0.15),
+                        mastery_1_element=int(_is.mastery_1_element * 0.15),
+                        mastery_2_elements=int(_is.mastery_2_elements * 0.15),
+                        mastery_3_elements=int(_is.mastery_2_elements * 0.15),
+                    )
+                if sublimations:
+                    neutrality_c = 0
+                    for sub in sublimations:
+                        if sub == 29001:
+                            neutrality_c += 1
+                        elif sub == 29002:
+                            neutrality_c += 2
+                        elif sub == 29002:
+                            neutrality_c += 3
+
+                    fd_mod = 8 * max(neutrality_c, 4)
+
+            base_score = non_crit_score = score_key(_is)
 
-            non_crit_score = base_score
             if UNRAVEL_ACTIVE:
                 base_score += statline.critical_mastery * (1.2 if ns.wakfu_class == ClassesEnum.Huppermage else 1)
+
             non_crit_score *= (100 - crit_chance) / 100
-            non_crit_score *= (100 + statline.fd) / 100
+            non_crit_score *= (100 + statline.fd) / 100 + fd_mod
 
             crit_score = base_score + statline.critical_mastery
             crit_score *= (crit_chance) / 100
-            crit_score *= (100 + statline.fd) / 100
+            crit_score *= (100 + statline.fd) / 100 + fd_mod
             crit_score *= 1.25
 
             score = crit_score + non_crit_score
 
             worst_kept = min(i[0] for i in solve_BEST_LIST) if 0 < len(solve_BEST_LIST) < 3 else 0
 
             if score > worst_kept:
```

## wakautosolver/utils.py

```diff
@@ -1,14 +1,15 @@
 """
 This Source Code Form is subject to the terms of the Mozilla Public
 License, v. 2.0. If a copy of the MPL was not distributed with this
 file, You can obtain one at http://mozilla.org/MPL/2.0/.
 
 Copyright (C) 2023 Michael Hall <https://github.com/mikeshardmind>
 """
+
 from __future__ import annotations
 
 from collections.abc import Callable
 from typing import ParamSpec
 
 P = ParamSpec("P")
```

## wakautosolver/versioned_entrypoints.py

```diff
@@ -1,29 +1,31 @@
 """
 This Source Code Form is subject to the terms of the Mozilla Public
 License, v. 2.0. If a copy of the MPL was not distributed with this
 file, You can obtain one at http://mozilla.org/MPL/2.0/.
 
 Copyright (C) 2023 Michael Hall <https://github.com/mikeshardmind>
 """
+
 from __future__ import annotations
 
+import enum
 import traceback
 import zlib
 from collections.abc import Callable
 from typing import Literal
 
 from msgspec import Struct, field, msgpack
 from msgspec.structs import asdict
 
 from . import __version__
 from ._short_debug_info import Wakforge_v2ShortError, v2BuildConfig
 from .b2048 import encode as b2048encode
 from .object_parsing import load_item_source_data
-from .restructured_types import DUMMY_MAX, DUMMY_MIN, ClassElements, ElementsEnum, Priority, StatPriority, Stats
+from .restructured_types import DUMMY_MAX, DUMMY_MIN, ClassElements, ElementsEnum, Priority, StatPriority
 from .restructured_types import SetMaximums as RealSetMaxs
 from .restructured_types import SetMinimums as RealSetMins
 from .solver import ImpossibleStatError, SolveError, solve, v1Config
 from .wakforge_buildcodes import Buildv1 as WFBuild
 
 ClassNames = Literal[
     "Feca",
@@ -144,115 +146,51 @@
             ("berserk_mastery", "beserk_mastery"),
         ):
             data[new] = data.pop(old)
 
         return RealSetMaxs(**data)
 
 
-def partial_solve_v1(
-    *,
-    lv: int,
-    stats: Stats,
-    target_stats: RealSetMins,
-    equipped_items: list[int],
-    num_mastery: int,
-    allowed_rarities: list[int],
-    dist: bool = False,
-    melee: bool = False,
-    heal: bool = False,
-    zerk: bool = False,
-    rear: bool = False,
-    dry_run: bool = False,
-) -> v1Result:
-    """
-    Doesn't handle sublimations, passives, etc yet
-
-    Use from pyodide:
-
-    // passing in other values besides the below
-    // may cause problems with solve quality for v1
-    let targets = SetMinimum.callKwargs({ap: 12, mp: 6, ra: 2, wp: 0});
-
-
-    // for the full list of supported Stats, see Stats class
-    let stats = Stats.callKwargs({ap: 7, mp: 4, ...});
-
-    let [result, error] = partial_solve_v1.callKwargs(
-        {
-        stats: stats,
-        target_stats: targets,
-        }
-    )
-    """
-
-    ap = target_stats.ap - stats.ap
-    mp = target_stats.mp - stats.mp
-    ra = target_stats.ra - stats.ra
-    wp = target_stats.wp - stats.wp
-
-    forbidden_rarities = [i for i in range(1, 8) if i not in allowed_rarities]
-
-    equipped = [i for i in equipped_items if i] if equipped_items else []
-
-    cfg = v1Config(
-        lv=lv,
-        ap=ap,
-        mp=mp,
-        wp=wp,
-        ra=ra,
-        baseap=stats.ap,
-        basemp=stats.mp,
-        basera=stats.ra,
-        bawewp=stats.wp,
-        bcrit=stats.critical_hit - 3,  # wakforge is doing something wrong here, won't be fixes for this entrypoint
-        bcmast=stats.critical_mastery,
-        bmast=stats.elemental_mastery,
-        num_mastery=num_mastery,
-        forbid_rarity=forbidden_rarities,
-        idforce=equipped,
-        dist=dist,
-        melee=melee,
-        heal=heal,
-        zerk=zerk,
-        rear=rear,
-        dry_run=dry_run,
-        hard_cap_depth=15,
-        tolerance=_adaptive_tolerance_map.get(lv, 14),
-        search_depth=1 if dry_run else 1,
-    )
-
-    try:
-        result = solve(cfg)
-        best = result[0]
-    except (IndexError, SolveError):
-        return (None, "No possible solution found")
-
-    _score, items = best
-    item_ids = [i.item_id for i in items]
-    return (item_ids, None)
+class SolveType(enum.IntEnum):
+    OPTIMIZE = 1
+    QUICK = 2
+    FIRST_MATCH = 3
 
 
 class v2Config(Struct):
     allowed_rarities: list[int] = field(default_factory=lambda: [1, 2, 3, 4, 5, 6, 7])
     target_stats: SetMinimums = field(default_factory=SetMinimums)
     dry_run: bool = False
     objectives: StatPriority = field(default_factory=StatPriority)
     forbidden_items: list[int] = field(default_factory=list)
     ignore_existing_items: bool = False
     forbidden_sources: list[Literal["arch", "horde", "pvp", "ultimate_boss", "blueprints"]] = field(default_factory=list)
     stats_maxs: SetMaximums = field(default_factory=SetMaximums)
+    enable_testing_features: bool = False
+    solve_type: SolveType = SolveType.OPTIMIZE
+
+
+v3Config = v2Config
 
 
 class v2Result(Struct):
     build_code: str | None = None
     error_code: str | None = None
     item_ids: list[int] = field(default_factory=list)
     debug_info: str | None = None
 
 
+class v3Result(Struct):
+    build_code: str | None = None
+    error_code: str | None = None
+    item_ids: list[int] = field(default_factory=list)
+    debug_info: str | None = None
+    user_display_message: str | None = None
+
+
 def compressed_encode(obj: object) -> str:
     compressor = zlib.compressobj(level=9, wbits=-15)
     packed = msgpack.encode(obj)
     return b2048encode(compressor.compress(packed) + compressor.flush())
 
 
 def partial_solve_v2(
@@ -346,15 +284,21 @@
         hard_cap_depth=50,
         tolerance=_adaptive_tolerance_map.get(build.level, 14),
         search_depth=1,
         elements=config.objectives.elements,
     )
 
     try:
-        result = solve(cfg, progress_callback=progress_callback, point_spread=point_spread, passives=build.get_passives())
+        result = solve(
+            cfg,
+            progress_callback=progress_callback,
+            point_spread=point_spread,
+            passives=build.get_passives(),
+            sublimations=build.get_sublimations(),
+        )
         best = result[0]
     except ImpossibleStatError as exc:
         return v2Result(None, exc.args[0], debug_info=None)
     except (IndexError, SolveError):
         return v2Result(None, "No possible solution found", debug_info=None)
     except Exception as exc:  # noqa: BLE001
         msg = traceback.format_exception(exc)
@@ -380,17 +324,13 @@
         try:
             if item.item_id in item_ids:
                 build.add_elements_to_item(item.item_id, elements)
             else:
                 build.add_item(item, elements)
         except RuntimeError as exc:
             msg = "".join(traceback.format_exception(exc))
-            err = Wakforge_v2ShortError(
-                version=__version__,
-                solve_params=v2BuildConfig(build, config.objectives),
-                message=msg
-            )
+            err = Wakforge_v2ShortError(version=__version__, solve_params=v2BuildConfig(build, config.objectives), message=msg)
             return v2Result(None, "Unknown error, see debug info", debug_info=compressed_encode(err))
 
     debug_info = compressed_encode({"score": score})
 
     return v2Result(build.to_code(), None, found_item_ids, debug_info=debug_info)
```

## wakautosolver/wakforge_buildcodes.py

```diff
@@ -1,17 +1,19 @@
 """
 This Source Code Form is subject to the terms of the Mozilla Public
 License, v. 2.0. If a copy of the MPL was not distributed with this
 file, You can obtain one at http://mozilla.org/MPL/2.0/.
 
 Copyright (C) 2023 Michael Hall <https://github.com/mikeshardmind>
 """
+
 from __future__ import annotations
 
 import zlib
+from collections.abc import Sequence
 from functools import partial
 from itertools import compress, count
 from operator import eq
 from typing import Literal
 
 from msgspec import Struct, field, msgpack
 from msgspec.structs import astuple
@@ -57,15 +59,15 @@
     "PET",
     "LEFT_HAND",  # RIGHT_HAND, but ...
     "SECOND_WEAPON",
     "SHOULDERS",
 ]
 
 
-class Buildv1(Struct, array_like=True):
+class Buildv1(Struct, array_like=True, omit_defaults=True):
     buildcodeversion: SupportedVersions = 1
     classenum: WFClasses = WFClasses.EMPTY
     level: int = 230
     # allocated stats
     s_int_percent_hp: STAT_MAX = 0
     s_int_elemental_res: UP_TO_10 = 0
     s_int_barrier: UP_TO_10 = 0
@@ -136,42 +138,44 @@
         s = msgpack.decode(zlib.decompress(b2048.decode(code), wbits=-15))
         s[1] = WFClasses(s[1])
         items = s[32:46]
         for idx, item in enumerate(items, 32):
             if not item:
                 s[idx] = Item()
             else:
-                item_id, elements, runes, subs = item
-                if item_id == -1:
-                    s[idx] = Item()
-                    continue
-                runes = [Rune() for r in runes if r]
-                s[idx] = Item(item_id, WFElements(elements), runes, subs)
+                item_id, elements, runes, sub = item
+                if elements == [0, 0, 0]:
+                    elements = WFElements.empty.value
+                runes = [Rune(*r) for r in runes if r]
+                s[idx] = Item(item_id, WFElements(elements), runes, sub)
 
         return cls(*s)
 
     def get_allocated_stats(self) -> AllocatedStats:
         tup = astuple(self)
         return AllocatedStats(*tup[3:32])
 
     def clear_items(self) -> None:
         empty = Item()
         for idx in range(1, 15):
             setattr(self, f"item_{idx}", empty)
 
+    def _getitems(self) -> Sequence[Item]:
+        return astuple(self)[32:46]
+
     def get_items(self) -> list[Item]:
         """
         Wakforge attaches 2 sublimations to an item matching how
         the game does it instead of the idealized structure,
         converstion to an idealized build requires knowing which sublimations
         are relic and epic sublimations, and isn't important right now.
         """
-        items = astuple(self)[32:46]
+        items = self._getitems()
         # wakforge sends fake items rather than not sending them, a subarray for items would be lovely...
-        return [i for i in items if isinstance(i, Item) and i]
+        return [i for i in items if i]
 
     def add_elements_to_item(self, item_id: int, elements: WFElements) -> None:
         for idx in range(1, 15):
             item: Item | None = getattr(self, f"item_{idx}", None)
             if item and item.item_id == item_id:
                 item.assignable_elements = elements
                 setattr(self, f"item_{idx}", item)
@@ -192,14 +196,21 @@
         compressor = zlib.compressobj(level=9, wbits=-15)
         return b2048.encode(compressor.compress(packed) + compressor.flush())
 
     def get_passives(self) -> list[int]:
         passives = (self.passive_1, self.passive_2, self.passive_3, self.passive_4, self.passive_5, self.passive_6)
         return [p for p in passives if p > -1]
 
+    def get_sublimations(self) -> list[int]:
+        return [
+            sid
+            for sid in (self.relic_sublimation_id, self.epic_sublimation_id, *(i.sublimation for i in self._getitems()))
+            if sid > 0
+        ]
+
 
 def build_code_from_items(level: int, items: list[EquipableItem]) -> str:
     items = [i for i in items if i.item_id > 0]  # filter out placeholder items
     build = Buildv1(level=level)
     for item in items:
         build.add_item(item)
     packed = msgpack.encode(build)
```

## wakautosolver/b2048/encoder.py

```diff
@@ -5,15 +5,14 @@
 
 Copyright (C) 2023 Michael Hall <https://github.com/mikeshardmind>
 """
 
 # This is a pure python re-implementation of https://github.com/ionite34/base2048
 # which is available under the MIT License here: https://github.com/ionite34/base2048/blob/main/LICENSE
 
-
 from __future__ import annotations
 
 from collections import deque
 from collections.abc import Iterable
 from io import StringIO
 from typing import Generic, TypeVar
```

## Comparing `wakautosolver-2024.4.6.dist-info/METADATA` & `wakautosolver-2024.4.7.dist-info/METADATA`

 * *Files 0% similar despite different names*

```diff
@@ -1,10 +1,10 @@
 Metadata-Version: 2.1
 Name: wakautosolver
-Version: 2024.4.6
+Version: 2024.4.7
 Project-URL: Homepage, https://github.com/mikeshardmind/wakfu-utils
 Author-email: Michael Hall <michael@michaelhall.tech>
 License-Expression: MPL-2.0
 License-File: LICENSE
 Requires-Python: >=3.11
 Requires-Dist: msgspec>=0.18.4
 Requires-Dist: tqdm>=4.66.1
```

## Comparing `wakautosolver-2024.4.6.dist-info/licenses/LICENSE` & `wakautosolver-2024.4.7.dist-info/licenses/LICENSE`

 * *Files identical despite different names*

## Comparing `wakautosolver-2024.4.6.dist-info/RECORD` & `wakautosolver-2024.4.7.dist-info/RECORD`

 * *Files 15% similar despite different names*

```diff
@@ -1,31 +1,33 @@
 LICENSE,sha256=HyVuytGSiAUQ6ErWBHTqt1iSGHhLmlC8fO7jTCuR8dU,16725
 .venv/Lib/site-packages/scripts/item_data.bz2,sha256=f_QL9zVv3F1o1zt0tCyqb5-UOQ1hTxsvTtD-p-ZYFAU,453356
-.venv/Lib/site-packages/scripts/locale_bundle.bz2,sha256=vZRfALj01hgsmGrlDPpYgGaK9oEXnhrfJusqHTXCKHY,137411
+.venv/Lib/site-packages/wakautosolver/data/locale_bundle.bz2,sha256=qPnB2vjm0f6lx4L0Q3sG4ERn1a3wnWyyhj7OP67Fn_g,137716
+.venv/Lib/site-packages/wakautosolver/data/source_info.bz2,sha256=gNncw2ohMpBlpOJtHPt9_-3wJngtgK3eitZgjGaw-O0,3178
+.venv/Lib/site-packages/wakautosolver/data/stat_only_bundle.bz2,sha256=Yo2hDD3m96Ow10hxHXdoVqspJahe19yW3QFV71CY-cM,85259
 scripts/item_data.bz2,sha256=f_QL9zVv3F1o1zt0tCyqb5-UOQ1hTxsvTtD-p-ZYFAU,453356
-wakautosolver/__init__.py,sha256=Mk7X_pw8JaevkVwwzyWsVDlcV6-hG-tiAfC1fMmnMT0,569
+wakautosolver/__init__.py,sha256=Zw5AWkY4TweC2iF46a8_UjisxjpyZ7nNrDHyz34wGLo,569
 wakautosolver/__main__.py,sha256=UtGrY1NrAkSGgj2e5SBkbmgRFMuojHZZr0ZE25x-UVY,764
-wakautosolver/_build_codes.py,sha256=oTgmSQqZJYa-SVv4dL1ctVxGtz9gkvGR0mi0vkPPK1E,3851
-wakautosolver/_short_debug_info.py,sha256=8Dq1NJugZJBGWxlcjj5M5gAmXCWpaiqA0Bq2UOB-S7w,1274
-wakautosolver/_typing_memes.py,sha256=ygR25rAn58tPoflK4iZzU45B8e94cii1cqcAkQ6biVQ,1713
-wakautosolver/item_conditions.py,sha256=KnlUyLunO4dY_oO9rtX8cYhYv08kBMgCz0V2ghK-IDk,4466
-wakautosolver/object_parsing.py,sha256=egdLr_jFMAfrSOZuY_wU2WMhfknuxQH9r05OJ-pleM0,11415
+wakautosolver/_build_codes.py,sha256=S3OPn3oaC4MWy_O9exDqQFzFjhoAEae8qQZuD3vM4AQ,3852
+wakautosolver/_short_debug_info.py,sha256=KRQCXtPT-DZ9WjHEgACoOdzkuz0emKDWduKOactEj7s,1275
+wakautosolver/_typing_memes.py,sha256=TPMr-XPZHddTjq0BE_27_fIOGTpbWUn993JJ-Zhun6I,1714
+wakautosolver/item_conditions.py,sha256=hSXBylIxf8OM9oM6toPNWvq42pVLdN3iBSieXCTH4Ts,4467
+wakautosolver/object_parsing.py,sha256=typnJwgn_NMcvuAFMPTYHihs1SgOMYjFcLVguqo6eHI,11416
 wakautosolver/py.typed,sha256=47DEQpj8HBSa-_TImW-5JCeuQeRkm5NMpJWZG3hSuFU,0
-wakautosolver/restructured_types.py,sha256=E2_uADC8HzkLAXnj0iD0xRtEGNgr6zalUdVcjuYhHYA,17069
-wakautosolver/solver.py,sha256=76BIzFmwmdKAVaXWClU5FpfhDxiil4bJn60F3cBIyyM,53178
-wakautosolver/utils.py,sha256=KtuyMFKwOj4J1FMKyVTTuSVbQl3Eqw9GLSZLtaDAiRM,674
-wakautosolver/versioned_entrypoints.py,sha256=VprHHdNYFa2-_-s4dctAzKVkWW7Pz-5zL5ktiTNQURU,12989
-wakautosolver/wakforge_buildcodes.py,sha256=RsabiDwaVBIimPz9KCALidWZcSEkM514tRiKuIXUU2o,7331
+wakautosolver/restructured_types.py,sha256=LExfRX-n5-cXy4KgD6O1Ljr4O0DQpFWkN-NpSS-Y7hQ,17342
+wakautosolver/solver.py,sha256=XZV64fumUsF_kl5wCP9TccToU7SaT3LKBV7YRjS3dPw,55436
+wakautosolver/utils.py,sha256=wfbf0VM7BR5DTUTDWefx3RqIm_6_U57Q6Y5-TtaRoJQ,675
+wakautosolver/versioned_entrypoints.py,sha256=TOPm4cEAdLzKMKtwXBpdUFPTpDdeyqLhlE_rGBGTyDI,11314
+wakautosolver/wakforge_buildcodes.py,sha256=PqA8dGnek9FQYZoIUU99pnXMqq_-cBKidXdwtp2sMGQ,7671
 wakautosolver/b2048/__init__.py,sha256=AbMdWj28dc94x-b-_NuF6uXrZ4eeUU2ZG9nDj8hq_jM,366
 wakautosolver/b2048/dec_table.py,sha256=1LZWoaSeQWs7OeSzkmrYA4FkoSSnDJK_y83gkqRZqQM,49861
 wakautosolver/b2048/enc_table.py,sha256=RE5kddBNQarcYjLbDxK-edOpP4iO5TgqyRoHQdpvHHk,21610
-wakautosolver/b2048/encoder.py,sha256=q8U17Vb-3pVNPxoAnKXEzhzzZDgZPxRNjk7UBnliV0s,3634
+wakautosolver/b2048/encoder.py,sha256=BB7sb7JgPwKmC2EjtOaav4kdgHwC14cWhE0XK4LtcY4,3633
 wakautosolver/data/items.db,sha256=1YD6rj7orqZLYpzFvp7rtWxP40EB4ORsYtABY6AMmzE,1212416
 wakautosolver/data/items.sql,sha256=JVdEiOL0orOhBCnMzSwUgxFVjn8SH-Ru9UZvgUkromk,1992029
 wakautosolver/data/locale_bundle.bz2,sha256=qPnB2vjm0f6lx4L0Q3sG4ERn1a3wnWyyhj7OP67Fn_g,137716
 wakautosolver/data/readme.md,sha256=GQ8oPIi_oTVznNypRYsq6v-ptAKPTILRFI3OIJzsYko,75
 wakautosolver/data/source_info.bz2,sha256=gNncw2ohMpBlpOJtHPt9_-3wJngtgK3eitZgjGaw-O0,3178
 wakautosolver/data/stat_only_bundle.bz2,sha256=Yo2hDD3m96Ow10hxHXdoVqspJahe19yW3QFV71CY-cM,85259
-wakautosolver-2024.4.6.dist-info/METADATA,sha256=6434awU_bGNMSYxtbK-uoK7is0sQkYQGbcnwWTt5p1M,6104
-wakautosolver-2024.4.6.dist-info/WHEEL,sha256=9QBuHhg6FNW7lppboF2vKVbCGTVzsFykgRQjjlajrhA,87
-wakautosolver-2024.4.6.dist-info/licenses/LICENSE,sha256=HyVuytGSiAUQ6ErWBHTqt1iSGHhLmlC8fO7jTCuR8dU,16725
-wakautosolver-2024.4.6.dist-info/RECORD,,
+wakautosolver-2024.4.7.dist-info/METADATA,sha256=FtUsgUDR0ftgko5sFZLJP5d6FsTcXNUqcExUyDHTAmk,6104
+wakautosolver-2024.4.7.dist-info/WHEEL,sha256=9QBuHhg6FNW7lppboF2vKVbCGTVzsFykgRQjjlajrhA,87
+wakautosolver-2024.4.7.dist-info/licenses/LICENSE,sha256=HyVuytGSiAUQ6ErWBHTqt1iSGHhLmlC8fO7jTCuR8dU,16725
+wakautosolver-2024.4.7.dist-info/RECORD,,
```

